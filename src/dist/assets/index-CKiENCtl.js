(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const t of n)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function s(n){const t={};return n.integrity&&(t.integrity=n.integrity),n.referrerPolicy&&(t.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?t.credentials="include":n.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(n){if(n.ep)return;n.ep=!0;const t=s(n);fetch(n.href,t)}})();var oe={},Fe=Object.getOwnPropertyNames,P=(e,i)=>function(){return i||(0,e[Fe(e)[0]])((i={exports:{}}).exports,i),i.exports},be=P({"node_modules/threads/dist/serializers.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultSerializer=e.extendSerializer=void 0;function i(n,t){const r=n.deserialize.bind(n),c=n.serialize.bind(n);return{deserialize(o){return t.deserialize(o,r)},serialize(o){return t.serialize(o,c)}}}e.extendSerializer=i;var s={deserialize(n){return Object.assign(Error(n.message),{name:n.name,stack:n.stack})},serialize(n){return{__error_marker:"$$error",message:n.message,name:n.name,stack:n.stack}}},a=n=>n&&typeof n=="object"&&"__error_marker"in n&&n.__error_marker==="$$error";e.DefaultSerializer={deserialize(n){return a(n)?s.deserialize(n):n},serialize(n){return n instanceof Error?s.serialize(n):n}}}}),$=P({"node_modules/threads/dist/common.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.serialize=e.deserialize=e.registerSerializer=void 0;var i=be(),s=i.DefaultSerializer;function a(r){s=i.extendSerializer(s,r)}e.registerSerializer=a;function n(r){return s.deserialize(r)}e.deserialize=n;function t(r){return s.serialize(r)}e.serialize=t}}),Re=P({"node_modules/threads/dist/master/get-bundle-url.browser.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getBundleURL=e.getBaseURL=void 0;var i;function s(){return i||(i=a()),i}e.getBundleURL=s;function a(){try{throw new Error}catch(t){const r=(""+t.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(r)return n(r[0])}return"/"}function n(t){return(""+t).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)?\/[^/]+(?:\?.*)?$/,"$1")+"/"}e.getBaseURL=n}}),ge=P({"node_modules/threads/dist/master/implementation.browser.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isWorkerRuntime=e.getWorkerImplementation=e.defaultPoolSize=void 0;var i=Re();e.defaultPoolSize=typeof navigator<"u"&&navigator.hardwareConcurrency?navigator.hardwareConcurrency:4;var s=o=>/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(o);function a(o){const l=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(l)}function n(){if(typeof Worker>"u")return class{constructor(){throw Error("No web worker implementation available. You might have tried to spawn a worker within a worker in a browser that doesn't support workers in workers.")}};class o extends Worker{constructor(m,p){var f,_;typeof m=="string"&&p&&p._baseURL?m=new URL(m,p._baseURL):typeof m=="string"&&!s(m)&&i.getBundleURL().match(/^file:\/\//i)&&(m=new URL(m,i.getBundleURL().replace(/\/[^\/]+$/,"/")),(!((f=p==null?void 0:p.CORSWorkaround)!==null&&f!==void 0)||f)&&(m=a(`importScripts(${JSON.stringify(m)});`))),typeof m=="string"&&s(m)&&(!((_=p==null?void 0:p.CORSWorkaround)!==null&&_!==void 0)||_)&&(m=a(`importScripts(${JSON.stringify(m)});`)),super(m,p)}}class l extends o{constructor(m,p){const f=window.URL.createObjectURL(m);super(f,p)}static fromText(m,p){const f=new window.Blob([m],{type:"text/javascript"});return new l(f,p)}}return{blob:l,default:o}}var t;function r(){return t||(t=n()),t}e.getWorkerImplementation=r;function c(){const o=typeof self<"u"&&typeof Window<"u"&&self instanceof Window;return!!(typeof self<"u"&&self.postMessage&&!o)}e.isWorkerRuntime=c}}),qe=P({"node_modules/ms/index.js"(e,i){var s=1e3,a=s*60,n=a*60,t=n*24,r=t*7,c=t*365.25;i.exports=function(p,f){f=f||{};var _=typeof p;if(_==="string"&&p.length>0)return o(p);if(_==="number"&&isFinite(p))return f.long?b(p):l(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function o(p){if(p=String(p),!(p.length>100)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(f){var _=parseFloat(f[1]),k=(f[2]||"ms").toLowerCase();switch(k){case"years":case"year":case"yrs":case"yr":case"y":return _*c;case"weeks":case"week":case"w":return _*r;case"days":case"day":case"d":return _*t;case"hours":case"hour":case"hrs":case"hr":case"h":return _*n;case"minutes":case"minute":case"mins":case"min":case"m":return _*a;case"seconds":case"second":case"secs":case"sec":case"s":return _*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return _;default:return}}}}function l(p){var f=Math.abs(p);return f>=t?Math.round(p/t)+"d":f>=n?Math.round(p/n)+"h":f>=a?Math.round(p/a)+"m":f>=s?Math.round(p/s)+"s":p+"ms"}function b(p){var f=Math.abs(p);return f>=t?m(p,f,t,"day"):f>=n?m(p,f,n,"hour"):f>=a?m(p,f,a,"minute"):f>=s?m(p,f,s,"second"):p+" ms"}function m(p,f,_,k){var S=f>=_*1.5;return Math.round(p/_)+" "+k+(S?"s":"")}}}),We=P({"node_modules/debug/src/common.js"(e,i){function s(a){t.debug=t,t.default=t,t.coerce=m,t.disable=l,t.enable=c,t.enabled=b,t.humanize=qe(),t.destroy=p,Object.keys(a).forEach(f=>{t[f]=a[f]}),t.names=[],t.skips=[],t.formatters={};function n(f){let _=0;for(let k=0;k<f.length;k++)_=(_<<5)-_+f.charCodeAt(k),_|=0;return t.colors[Math.abs(_)%t.colors.length]}t.selectColor=n;function t(f){let _,k=null,S,v;function d(...u){if(!d.enabled)return;const y=d,w=Number(new Date),h=w-(_||w);y.diff=h,y.prev=_,y.curr=w,_=w,u[0]=t.coerce(u[0]),typeof u[0]!="string"&&u.unshift("%O");let E=0;u[0]=u[0].replace(/%([a-zA-Z%])/g,(g,C)=>{if(g==="%%")return"%";E++;const T=t.formatters[C];if(typeof T=="function"){const A=u[E];g=T.call(y,A),u.splice(E,1),E--}return g}),t.formatArgs.call(y,u),(y.log||t.log).apply(y,u)}return d.namespace=f,d.useColors=t.useColors(),d.color=t.selectColor(f),d.extend=r,d.destroy=t.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>k!==null?k:(S!==t.namespaces&&(S=t.namespaces,v=t.enabled(f)),v),set:u=>{k=u}}),typeof t.init=="function"&&t.init(d),d}function r(f,_){const k=t(this.namespace+(typeof _>"u"?":":_)+f);return k.log=this.log,k}function c(f){t.save(f),t.namespaces=f,t.names=[],t.skips=[];const _=(typeof f=="string"?f:"").trim().replace(" ",",").split(",").filter(Boolean);for(const k of _)k[0]==="-"?t.skips.push(k.slice(1)):t.names.push(k)}function o(f,_){let k=0,S=0,v=-1,d=0;for(;k<f.length;)if(S<_.length&&(_[S]===f[k]||_[S]==="*"))_[S]==="*"?(v=S,d=k,S++):(k++,S++);else if(v!==-1)S=v+1,d++,k=d;else return!1;for(;S<_.length&&_[S]==="*";)S++;return S===_.length}function l(){const f=[...t.names,...t.skips.map(_=>"-"+_)].join(",");return t.enable(""),f}function b(f){for(const _ of t.skips)if(o(f,_))return!1;for(const _ of t.names)if(o(f,_))return!0;return!1}function m(f){return f instanceof Error?f.stack||f.message:f}function p(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}i.exports=s}}),ce=P({"node_modules/debug/src/browser.js"(e,i){e.formatArgs=a,e.save=n,e.load=t,e.useColors=s,e.storage=r(),e.destroy=(()=>{let o=!1;return()=>{o||(o=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let o;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(o=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(o[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function a(o){if(o[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+o[0]+(this.useColors?"%c ":" ")+"+"+i.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;o.splice(1,0,l,"color: inherit");let b=0,m=0;o[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(b++,p==="%c"&&(m=b))}),o.splice(m,0,l)}e.log=console.debug||console.log||(()=>{});function n(o){try{o?e.storage.setItem("debug",o):e.storage.removeItem("debug")}catch{}}function t(){let o;try{o=e.storage.getItem("debug")}catch{}return!o&&typeof process<"u"&&"env"in process&&(o=oe.DEBUG),o}function r(){try{return localStorage}catch{}}i.exports=We()(e);var{formatters:c}=i.exports;c.j=function(o){try{return JSON.stringify(o)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}}}),X=P({"node_modules/observable-fns/dist/_scheduler.js"(e){var i=e&&e.__awaiter||function(a,n,t,r){function c(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function b(f){try{p(r.next(f))}catch(_){l(_)}}function m(f){try{p(r.throw(f))}catch(_){l(_)}}function p(f){f.done?o(f.value):c(f.value).then(b,m)}p((r=r.apply(a,n||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncSerialScheduler=void 0;var s=class{constructor(a){this._baseObserver=a,this._pendingPromises=new Set}complete(){Promise.all(this._pendingPromises).then(()=>this._baseObserver.complete()).catch(a=>this._baseObserver.error(a))}error(a){this._baseObserver.error(a)}schedule(a){const n=Promise.all(this._pendingPromises),t=[],r=o=>t.push(o),c=Promise.resolve().then(()=>i(this,void 0,void 0,function*(){yield n,yield a(r),this._pendingPromises.delete(c);for(const o of t)this._baseObserver.next(o)})).catch(o=>{this._pendingPromises.delete(c),this._baseObserver.error(o)});this._pendingPromises.add(c)}};e.AsyncSerialScheduler=s}}),Ne=P({"node_modules/observable-fns/dist/symbols.js"(e){Object.defineProperty(e,"__esModule",{value:!0})}}),we=P({"node_modules/observable-fns/dist/_symbols.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.registerObservableSymbol=e.getSymbol=e.hasSymbol=e.hasSymbols=void 0;var i=()=>typeof Symbol=="function";e.hasSymbols=i;var s=t=>e.hasSymbols()&&!!Symbol[t];e.hasSymbol=s;var a=t=>e.hasSymbol(t)?Symbol[t]:"@@"+t;e.getSymbol=a;function n(){e.hasSymbols()&&!e.hasSymbol("observable")&&(Symbol.observable=Symbol("observable"))}e.registerObservableSymbol=n,e.hasSymbol("asyncIterator")||(Symbol.asyncIterator=Symbol.asyncIterator||Symbol.for("Symbol.asyncIterator"))}}),R=P({"node_modules/observable-fns/dist/observable.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Observable=e.SubscriptionObserver=e.Subscription=void 0,Ne();var i=we(),s=i.getSymbol("iterator"),a=i.getSymbol("observable"),n=i.getSymbol("species");function t(d,u){const y=d[u];if(y!=null){if(typeof y!="function")throw new TypeError(y+" is not a function");return y}}function r(d){let u=d.constructor;return u!==void 0&&(u=u[n],u===null&&(u=void 0)),u!==void 0?u:v}function c(d){return d instanceof v}function o(d){o.log?o.log(d):setTimeout(()=>{throw d},0)}function l(d){Promise.resolve().then(()=>{try{d()}catch(u){o(u)}})}function b(d){const u=d._cleanup;if(u!==void 0&&(d._cleanup=void 0,!!u))try{if(typeof u=="function")u();else{const y=t(u,"unsubscribe");y&&y.call(u)}}catch(y){o(y)}}function m(d){d._observer=void 0,d._queue=void 0,d._state="closed"}function p(d){const u=d._queue;if(u){d._queue=void 0,d._state="ready";for(const y of u)if(f(d,y.type,y.value),d._state==="closed")break}}function f(d,u,y){d._state="running";const w=d._observer;try{const h=w?t(w,u):void 0;switch(u){case"next":h&&h.call(w,y);break;case"error":if(m(d),h)h.call(w,y);else throw y;break;case"complete":m(d),h&&h.call(w);break}}catch(h){o(h)}d._state==="closed"?b(d):d._state==="running"&&(d._state="ready")}function _(d,u,y){if(d._state!=="closed"){if(d._state==="buffering"){d._queue=d._queue||[],d._queue.push({type:u,value:y});return}if(d._state!=="ready"){d._state="buffering",d._queue=[{type:u,value:y}],l(()=>p(d));return}f(d,u,y)}}var k=class{constructor(d,u){this._cleanup=void 0,this._observer=d,this._queue=void 0,this._state="initializing";const y=new S(this);try{this._cleanup=u.call(void 0,y)}catch(w){y.error(w)}this._state==="initializing"&&(this._state="ready")}get closed(){return this._state==="closed"}unsubscribe(){this._state!=="closed"&&(m(this),b(this))}};e.Subscription=k;var S=class{constructor(d){this._subscription=d}get closed(){return this._subscription._state==="closed"}next(d){_(this._subscription,"next",d)}error(d){_(this._subscription,"error",d)}complete(){_(this._subscription,"complete")}};e.SubscriptionObserver=S;var v=class H{constructor(u){if(!(this instanceof H))throw new TypeError("Observable cannot be called as a function");if(typeof u!="function")throw new TypeError("Observable initializer must be a function");this._subscriber=u}subscribe(u,y,w){return(typeof u!="object"||u===null)&&(u={next:u,error:y,complete:w}),new k(u,this._subscriber)}pipe(u,...y){let w=this;for(const h of[u,...y])w=h(w);return w}tap(u,y,w){const h=typeof u!="object"||u===null?{next:u,error:y,complete:w}:u;return new H(E=>this.subscribe({next(M){h.next&&h.next(M),E.next(M)},error(M){h.error&&h.error(M),E.error(M)},complete(){h.complete&&h.complete(),E.complete()},start(M){h.start&&h.start(M)}}))}forEach(u){return new Promise((y,w)=>{if(typeof u!="function"){w(new TypeError(u+" is not a function"));return}function h(){E.unsubscribe(),y(void 0)}const E=this.subscribe({next(M){try{u(M,h)}catch(g){w(g),E.unsubscribe()}},error(M){w(M)},complete(){y(void 0)}})})}map(u){if(typeof u!="function")throw new TypeError(u+" is not a function");const y=r(this);return new y(w=>this.subscribe({next(h){let E=h;try{E=u(h)}catch(M){return w.error(M)}w.next(E)},error(h){w.error(h)},complete(){w.complete()}}))}filter(u){if(typeof u!="function")throw new TypeError(u+" is not a function");const y=r(this);return new y(w=>this.subscribe({next(h){try{if(!u(h))return}catch(E){return w.error(E)}w.next(h)},error(h){w.error(h)},complete(){w.complete()}}))}reduce(u,y){if(typeof u!="function")throw new TypeError(u+" is not a function");const w=r(this),h=arguments.length>1;let E=!1,M=y;return new w(g=>this.subscribe({next(C){const T=!E;if(E=!0,!T||h)try{M=u(M,C)}catch(A){return g.error(A)}else M=C},error(C){g.error(C)},complete(){if(!E&&!h)return g.error(new TypeError("Cannot reduce an empty sequence"));g.next(M),g.complete()}}))}concat(...u){const y=r(this);return new y(w=>{let h,E=0;function M(g){h=g.subscribe({next(C){w.next(C)},error(C){w.error(C)},complete(){E===u.length?(h=void 0,w.complete()):M(y.from(u[E++]))}})}return M(this),()=>{h&&(h.unsubscribe(),h=void 0)}})}flatMap(u){if(typeof u!="function")throw new TypeError(u+" is not a function");const y=r(this);return new y(w=>{const h=[],E=this.subscribe({next(g){let C;if(u)try{C=u(g)}catch(A){return w.error(A)}else C=g;const T=y.from(C).subscribe({next(A){w.next(A)},error(A){w.error(A)},complete(){const A=h.indexOf(T);A>=0&&h.splice(A,1),M()}});h.push(T)},error(g){w.error(g)},complete(){M()}});function M(){E.closed&&h.length===0&&w.complete()}return()=>{h.forEach(g=>g.unsubscribe()),E.unsubscribe()}})}[a](){return this}static from(u){const y=typeof this=="function"?this:H;if(u==null)throw new TypeError(u+" is not an object");const w=t(u,a);if(w){const h=w.call(u);if(Object(h)!==h)throw new TypeError(h+" is not an object");return c(h)&&h.constructor===y?h:new y(E=>h.subscribe(E))}if(i.hasSymbol("iterator")){const h=t(u,s);if(h)return new y(E=>{l(()=>{if(!E.closed){for(const M of h.call(u))if(E.next(M),E.closed)return;E.complete()}})})}if(Array.isArray(u))return new y(h=>{l(()=>{if(!h.closed){for(const E of u)if(h.next(E),h.closed)return;h.complete()}})});throw new TypeError(u+" is not observable")}static of(...u){const y=typeof this=="function"?this:H;return new y(w=>{l(()=>{if(!w.closed){for(const h of u)if(w.next(h),w.closed)return;w.complete()}})})}static get[n](){return this}};e.Observable=v,i.hasSymbols()&&Object.defineProperty(v,Symbol("extensions"),{value:{symbol:a,hostReportError:o},configurable:!0}),e.default=v}}),N=P({"node_modules/observable-fns/dist/unsubscribe.js"(e){Object.defineProperty(e,"__esModule",{value:!0});function i(s){typeof s=="function"?s():s&&typeof s.unsubscribe=="function"&&s.unsubscribe()}e.default=i}}),ze=P({"node_modules/observable-fns/dist/filter.js"(e){var i=e&&e.__awaiter||function(r,c,o,l){function b(m){return m instanceof o?m:new o(function(p){p(m)})}return new(o||(o=Promise))(function(m,p){function f(S){try{k(l.next(S))}catch(v){p(v)}}function _(S){try{k(l.throw(S))}catch(v){p(v)}}function k(S){S.done?m(S.value):b(S.value).then(f,_)}k((l=l.apply(r,c||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});var s=X(),a=R(),n=N();function t(r){return c=>new a.default(o=>{const l=new s.AsyncSerialScheduler(o),b=c.subscribe({complete(){l.complete()},error(m){l.error(m)},next(m){l.schedule(p=>i(this,void 0,void 0,function*(){(yield r(m))&&p(m)}))}});return()=>n.default(b)})}e.default=t}}),De=P({"node_modules/observable-fns/dist/_util.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isIterator=e.isAsyncIterator=void 0;var i=we();function s(n){return n&&i.hasSymbol("asyncIterator")&&n[Symbol.asyncIterator]}e.isAsyncIterator=s;function a(n){return n&&i.hasSymbol("iterator")&&n[Symbol.iterator]}e.isIterator=a}}),Be=P({"node_modules/observable-fns/dist/flatMap.js"(e){var i=e&&e.__awaiter||function(o,l,b,m){function p(f){return f instanceof b?f:new b(function(_){_(f)})}return new(b||(b=Promise))(function(f,_){function k(d){try{v(m.next(d))}catch(u){_(u)}}function S(d){try{v(m.throw(d))}catch(u){_(u)}}function v(d){d.done?f(d.value):p(d.value).then(k,S)}v((m=m.apply(o,l||[])).next())})},s=e&&e.__asyncValues||function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=o[Symbol.asyncIterator],b;return l?l.call(o):(o=typeof __values=="function"?__values(o):o[Symbol.iterator](),b={},m("next"),m("throw"),m("return"),b[Symbol.asyncIterator]=function(){return this},b);function m(f){b[f]=o[f]&&function(_){return new Promise(function(k,S){_=o[f](_),p(k,S,_.done,_.value)})}}function p(f,_,k,S){Promise.resolve(S).then(function(v){f({value:v,done:k})},_)}};Object.defineProperty(e,"__esModule",{value:!0});var a=X(),n=De(),t=R(),r=N();function c(o){return l=>new t.default(b=>{const m=new a.AsyncSerialScheduler(b),p=l.subscribe({complete(){m.complete()},error(f){m.error(f)},next(f){m.schedule(_=>i(this,void 0,void 0,function*(){var k,S;const v=yield o(f);if(n.isIterator(v)||n.isAsyncIterator(v))try{for(var d=s(v),u;u=yield d.next(),!u.done;){const y=u.value;_(y)}}catch(y){k={error:y}}finally{try{u&&!u.done&&(S=d.return)&&(yield S.call(d))}finally{if(k)throw k.error}}else v.map(y=>_(y))}))}});return()=>r.default(p)})}e.default=c}}),xe=P({"node_modules/observable-fns/dist/interval.js"(e){Object.defineProperty(e,"__esModule",{value:!0});var i=R();function s(a){return new i.Observable(n=>{let t=0;const r=setInterval(()=>{n.next(t++)},a);return()=>clearInterval(r)})}e.default=s}}),He=P({"node_modules/observable-fns/dist/map.js"(e){var i=e&&e.__awaiter||function(r,c,o,l){function b(m){return m instanceof o?m:new o(function(p){p(m)})}return new(o||(o=Promise))(function(m,p){function f(S){try{k(l.next(S))}catch(v){p(v)}}function _(S){try{k(l.throw(S))}catch(v){p(v)}}function k(S){S.done?m(S.value):b(S.value).then(f,_)}k((l=l.apply(r,c||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});var s=X(),a=R(),n=N();function t(r){return c=>new a.default(o=>{const l=new s.AsyncSerialScheduler(o),b=c.subscribe({complete(){l.complete()},error(m){l.error(m)},next(m){l.schedule(p=>i(this,void 0,void 0,function*(){const f=yield r(m);p(f)}))}});return()=>n.default(b)})}e.default=t}}),$e=P({"node_modules/observable-fns/dist/merge.js"(e){Object.defineProperty(e,"__esModule",{value:!0});var i=R(),s=N();function a(...n){return n.length===0?i.Observable.from([]):new i.Observable(t=>{let r=0;const c=n.map(l=>l.subscribe({error(b){t.error(b),o()},next(b){t.next(b)},complete(){++r===n.length&&(t.complete(),o())}})),o=()=>{c.forEach(l=>s.default(l))};return o})}e.default=a}}),ve=P({"node_modules/observable-fns/dist/subject.js"(e){Object.defineProperty(e,"__esModule",{value:!0});var i=R(),s=class extends i.default{constructor(){super(a=>(this._observers.add(a),()=>this._observers.delete(a))),this._observers=new Set}next(a){for(const n of this._observers)n.next(a)}error(a){for(const n of this._observers)n.error(a)}complete(){for(const a of this._observers)a.complete()}};e.default=s}}),Ve=P({"node_modules/observable-fns/dist/multicast.js"(e){Object.defineProperty(e,"__esModule",{value:!0});var i=R(),s=ve(),a=N();function n(t){const r=new s.default;let c,o=0;return new i.default(l=>{c||(c=t.subscribe(r));const b=r.subscribe(l);return o++,()=>{o--,b.unsubscribe(),o===0&&(a.default(c),c=void 0)}})}e.default=n}}),Ue=P({"node_modules/observable-fns/dist/scan.js"(e){var i=e&&e.__awaiter||function(r,c,o,l){function b(m){return m instanceof o?m:new o(function(p){p(m)})}return new(o||(o=Promise))(function(m,p){function f(S){try{k(l.next(S))}catch(v){p(v)}}function _(S){try{k(l.throw(S))}catch(v){p(v)}}function k(S){S.done?m(S.value):b(S.value).then(f,_)}k((l=l.apply(r,c||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});var s=X(),a=R(),n=N();function t(r,c){return o=>new a.default(l=>{let b,m=0;const p=new s.AsyncSerialScheduler(l),f=o.subscribe({complete(){p.complete()},error(_){p.error(_)},next(_){p.schedule(k=>i(this,void 0,void 0,function*(){b=yield r(m===0?typeof c>"u"?_:c:b,_,m++),k(b)}))}});return()=>n.default(f)})}e.default=t}}),Qe=P({"node_modules/observable-fns/dist/index.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.unsubscribe=e.Subject=e.scan=e.Observable=e.multicast=e.merge=e.map=e.interval=e.flatMap=e.filter=void 0;var i=ze();Object.defineProperty(e,"filter",{enumerable:!0,get:function(){return i.default}});var s=Be();Object.defineProperty(e,"flatMap",{enumerable:!0,get:function(){return s.default}});var a=xe();Object.defineProperty(e,"interval",{enumerable:!0,get:function(){return a.default}});var n=He();Object.defineProperty(e,"map",{enumerable:!0,get:function(){return n.default}});var t=$e();Object.defineProperty(e,"merge",{enumerable:!0,get:function(){return t.default}});var r=Ve();Object.defineProperty(e,"multicast",{enumerable:!0,get:function(){return r.default}});var c=R();Object.defineProperty(e,"Observable",{enumerable:!0,get:function(){return c.default}});var o=Ue();Object.defineProperty(e,"scan",{enumerable:!0,get:function(){return o.default}});var l=ve();Object.defineProperty(e,"Subject",{enumerable:!0,get:function(){return l.default}});var b=N();Object.defineProperty(e,"unsubscribe",{enumerable:!0,get:function(){return b.default}})}}),K=P({"node_modules/observable-fns/index.js"(e,i){i.exports=Qe()}}),Ge=P({"node_modules/threads/dist/ponyfills.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.allSettled=void 0;function i(s){return Promise.all(s.map(a=>{const n=c=>({status:"fulfilled",value:c}),t=c=>({status:"rejected",reason:c}),r=Promise.resolve(a);try{return r.then(n,t)}catch(c){return Promise.reject(c)}}))}e.allSettled=i}}),Je=P({"node_modules/threads/dist/master/pool-types.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PoolEventType=void 0,function(i){i.initialized="initialized",i.taskCanceled="taskCanceled",i.taskCompleted="taskCompleted",i.taskFailed="taskFailed",i.taskQueued="taskQueued",i.taskQueueDrained="taskQueueDrained",i.taskStart="taskStart",i.terminated="terminated"}(e.PoolEventType||(e.PoolEventType={}))}}),Y=P({"node_modules/threads/dist/symbols.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.$worker=e.$transferable=e.$terminate=e.$events=e.$errors=void 0,e.$errors=Symbol("thread.errors"),e.$events=Symbol("thread.events"),e.$terminate=Symbol("thread.terminate"),e.$transferable=Symbol("thread.transferable"),e.$worker=Symbol("thread.worker")}}),_e=P({"node_modules/threads/dist/master/thread.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Thread=void 0;var i=Y();function s(a){throw Error(a)}e.Thread={errors(a){return a[i.$errors]||s("Error observable not found. Make sure to pass a thread instance as returned by the spawn() promise.")},events(a){return a[i.$events]||s("Events observable not found. Make sure to pass a thread instance as returned by the spawn() promise.")},terminate(a){return a[i.$terminate]()}}}}),Ze=P({"node_modules/threads/dist/master/pool.js"(e){var i=e&&e.__awaiter||function(v,d,u,y){function w(h){return h instanceof u?h:new u(function(E){E(h)})}return new(u||(u=Promise))(function(h,E){function M(T){try{C(y.next(T))}catch(A){E(A)}}function g(T){try{C(y.throw(T))}catch(A){E(A)}}function C(T){T.done?h(T.value):w(T.value).then(M,g)}C((y=y.apply(v,d||[])).next())})},s=e&&e.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(e,"__esModule",{value:!0}),e.Pool=e.Thread=e.PoolEventType=void 0;var a=s(ce()),n=K(),t=Ge(),r=ge(),c=Je();Object.defineProperty(e,"PoolEventType",{enumerable:!0,get:function(){return c.PoolEventType}});var o=_e();Object.defineProperty(e,"Thread",{enumerable:!0,get:function(){return o.Thread}});var l=1;function b(v){const d=[];for(let u=0;u<v;u++)d.push(u);return d}function m(v){return new Promise(d=>setTimeout(d,v))}function p(v,d){return v.reduce((u,y)=>[...u,...d(y)],[])}function f(v){return v.replace(/\W/g," ").trim().replace(/\s+/g,"-")}function _(v,d){return b(d).map(()=>({init:v(),runningTasks:[]}))}var k=class{constructor(v,d){this.eventSubject=new n.Subject,this.initErrors=[],this.isClosing=!1,this.nextTaskID=1,this.taskQueue=[];const u=typeof d=="number"?{size:d}:d||{},{size:y=r.defaultPoolSize}=u;this.debug=a.default(`threads:pool:${f(u.name||String(l++))}`),this.options=u,this.workers=_(v,y),this.eventObservable=n.multicast(n.Observable.from(this.eventSubject)),Promise.all(this.workers.map(w=>w.init)).then(()=>this.eventSubject.next({type:c.PoolEventType.initialized,size:this.workers.length}),w=>{this.debug("Error while initializing pool worker:",w),this.eventSubject.error(w),this.initErrors.push(w)})}findIdlingWorker(){const{concurrency:v=1}=this.options;return this.workers.find(d=>d.runningTasks.length<v)}runPoolTask(v,d){return i(this,void 0,void 0,function*(){const u=this.workers.indexOf(v)+1;this.debug(`Running task #${d.id} on worker #${u}...`),this.eventSubject.next({type:c.PoolEventType.taskStart,taskID:d.id,workerID:u});try{const y=yield d.run(yield v.init);this.debug(`Task #${d.id} completed successfully`),this.eventSubject.next({type:c.PoolEventType.taskCompleted,returnValue:y,taskID:d.id,workerID:u})}catch(y){this.debug(`Task #${d.id} failed`),this.eventSubject.next({type:c.PoolEventType.taskFailed,taskID:d.id,error:y,workerID:u})}})}run(v,d){return i(this,void 0,void 0,function*(){const u=i(this,void 0,void 0,function*(){const y=()=>{v.runningTasks=v.runningTasks.filter(w=>w!==u)};yield m(0);try{yield this.runPoolTask(v,d)}finally{y(),this.isClosing||this.scheduleWork()}});v.runningTasks.push(u)})}scheduleWork(){this.debug("Attempt de-queueing a task in order to run it...");const v=this.findIdlingWorker();if(!v)return;const d=this.taskQueue.shift();if(!d){this.debug("Task queue is empty"),this.eventSubject.next({type:c.PoolEventType.taskQueueDrained});return}this.run(v,d)}taskCompletion(v){return new Promise((d,u)=>{const y=this.events().subscribe(w=>{w.type===c.PoolEventType.taskCompleted&&w.taskID===v?(y.unsubscribe(),d(w.returnValue)):w.type===c.PoolEventType.taskFailed&&w.taskID===v?(y.unsubscribe(),u(w.error)):w.type===c.PoolEventType.terminated&&(y.unsubscribe(),u(Error("Pool has been terminated before task was run.")))})})}settled(v=!1){return i(this,void 0,void 0,function*(){const d=()=>p(this.workers,w=>w.runningTasks),u=[],y=this.eventObservable.subscribe(w=>{w.type===c.PoolEventType.taskFailed&&u.push(w.error)});return this.initErrors.length>0?Promise.reject(this.initErrors[0]):v&&this.taskQueue.length===0?(yield t.allSettled(d()),u):(yield new Promise((w,h)=>{const E=this.eventObservable.subscribe({next(M){M.type===c.PoolEventType.taskQueueDrained&&(E.unsubscribe(),w(void 0))},error:h})}),yield t.allSettled(d()),y.unsubscribe(),u)})}completed(v=!1){return i(this,void 0,void 0,function*(){const d=this.settled(v),u=new Promise((w,h)=>{const E=this.eventObservable.subscribe({next(M){M.type===c.PoolEventType.taskQueueDrained?(E.unsubscribe(),w(d)):M.type===c.PoolEventType.taskFailed&&(E.unsubscribe(),h(M.error))},error:h})}),y=yield Promise.race([d,u]);if(y.length>0)throw y[0]})}events(){return this.eventObservable}queue(v){const{maxQueuedJobs:d=1/0}=this.options;if(this.isClosing)throw Error("Cannot schedule pool tasks after terminate() has been called.");if(this.initErrors.length>0)throw this.initErrors[0];const u=this.nextTaskID++,y=this.taskCompletion(u);y.catch(h=>{this.debug(`Task #${u} errored:`,h)});const w={id:u,run:v,cancel:()=>{this.taskQueue.indexOf(w)!==-1&&(this.taskQueue=this.taskQueue.filter(h=>h!==w),this.eventSubject.next({type:c.PoolEventType.taskCanceled,taskID:w.id}))},then:y.then.bind(y)};if(this.taskQueue.length>=d)throw Error(`Maximum number of pool tasks queued. Refusing to queue another one.
This usually happens for one of two reasons: We are either at peak workload right now or some tasks just won't finish, thus blocking the pool.`);return this.debug(`Queueing task #${w.id}...`),this.taskQueue.push(w),this.eventSubject.next({type:c.PoolEventType.taskQueued,taskID:w.id}),this.scheduleWork(),w}terminate(v){return i(this,void 0,void 0,function*(){this.isClosing=!0,v||(yield this.completed(!0)),this.eventSubject.next({type:c.PoolEventType.terminated,remainingQueue:[...this.taskQueue]}),this.eventSubject.complete(),yield Promise.all(this.workers.map(d=>i(this,void 0,void 0,function*(){return o.Thread.terminate(yield d.init)})))})}};k.EventType=c.PoolEventType;function S(v,d){return new k(v,d)}S.EventType=c.PoolEventType,e.Pool=S}}),Xe=P({"node_modules/threads/dist/promise.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createPromiseWithResolver=void 0;var i=()=>{};function s(){let a=!1,n,t=i;return[new Promise(o=>{a?o(n):t=o}),o=>{a=!0,n=o,t(n)}]}e.createPromiseWithResolver=s}}),Ke=P({"node_modules/threads/dist/types/master.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WorkerEventType=void 0,Y(),function(i){i.internalError="internalError",i.message="message",i.termination="termination"}(e.WorkerEventType||(e.WorkerEventType={}))}}),Ye=P({"node_modules/threads/dist/observable-promise.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ObservablePromise=void 0;var i=K(),s=()=>{},a=o=>o,n=o=>Promise.resolve().then(o);function t(o){throw o}function r(o){return o&&typeof o.then=="function"}var c=class ke extends i.Observable{constructor(l){super(b=>{const m=this,p=Object.assign(Object.assign({},b),{complete(){b.complete(),m.onCompletion()},error(f){b.error(f),m.onError(f)},next(f){b.next(f),m.onNext(f)}});try{return this.initHasRun=!0,l(p)}catch(f){p.error(f)}}),this.initHasRun=!1,this.fulfillmentCallbacks=[],this.rejectionCallbacks=[],this.firstValueSet=!1,this.state="pending"}onNext(l){this.firstValueSet||(this.firstValue=l,this.firstValueSet=!0)}onError(l){this.state="rejected",this.rejection=l;for(const b of this.rejectionCallbacks)n(()=>b(l))}onCompletion(){this.state="fulfilled";for(const l of this.fulfillmentCallbacks)n(()=>l(this.firstValue))}then(l,b){const m=l||a,p=b||t;let f=!1;return new Promise((_,k)=>{const S=d=>{if(!f){f=!0;try{_(p(d))}catch(u){k(u)}}},v=d=>{try{_(m(d))}catch(u){S(u)}};if(this.initHasRun||this.subscribe({error:S}),this.state==="fulfilled")return _(m(this.firstValue));if(this.state==="rejected")return f=!0,_(p(this.rejection));this.fulfillmentCallbacks.push(v),this.rejectionCallbacks.push(S)})}catch(l){return this.then(void 0,l)}finally(l){const b=l||s;return this.then(m=>(b(),m),()=>b())}static from(l){return r(l)?new ke(b=>{const m=f=>{b.next(f),b.complete()},p=f=>{b.error(f)};l.then(m,p)}):super.from(l)}};e.ObservablePromise=c}}),J=P({"node_modules/threads/dist/transferable.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Transfer=e.isTransferDescriptor=void 0;var i=Y();function s(t){return!(!t||typeof t!="object")}function a(t){return t&&typeof t=="object"&&t[i.$transferable]}e.isTransferDescriptor=a;function n(t,r){if(!r){if(!s(t))throw Error();r=[t]}return{[i.$transferable]:!0,send:t,transferables:r}}e.Transfer=n}}),Se=P({"node_modules/threads/dist/types/messages.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WorkerMessageType=e.MasterMessageType=void 0,function(i){i.cancel="cancel",i.run="run"}(e.MasterMessageType||(e.MasterMessageType={})),function(i){i.error="error",i.init="init",i.result="result",i.running="running",i.uncaughtError="uncaughtError"}(e.WorkerMessageType||(e.WorkerMessageType={}))}}),et=P({"node_modules/threads/dist/master/invocation-proxy.js"(e){var i=e&&e.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(e,"__esModule",{value:!0}),e.createProxyModule=e.createProxyFunction=void 0;var s=i(ce()),a=K(),n=$(),t=Ye(),r=J(),c=Se(),o=s.default("threads:master:messages"),l=1,b=d=>Array.from(new Set(d)),m=d=>d&&d.type===c.WorkerMessageType.error,p=d=>d&&d.type===c.WorkerMessageType.result,f=d=>d&&d.type===c.WorkerMessageType.running;function _(d,u){return new a.Observable(y=>{let w;const h=E=>{if(o("Message from worker:",E.data),!(!E.data||E.data.uid!==u)){if(f(E.data))w=E.data.resultType;else if(p(E.data))w==="promise"?(typeof E.data.payload<"u"&&y.next(n.deserialize(E.data.payload)),y.complete(),d.removeEventListener("message",h)):(E.data.payload&&y.next(n.deserialize(E.data.payload)),E.data.complete&&(y.complete(),d.removeEventListener("message",h)));else if(m(E.data)){const M=n.deserialize(E.data.error);y.error(M),d.removeEventListener("message",h)}}};return d.addEventListener("message",h),()=>{if(w==="observable"||!w){const E={type:c.MasterMessageType.cancel,uid:u};d.postMessage(E)}d.removeEventListener("message",h)}})}function k(d){if(d.length===0)return{args:[],transferables:[]};const u=[],y=[];for(const w of d)r.isTransferDescriptor(w)?(u.push(n.serialize(w.send)),y.push(...w.transferables)):u.push(n.serialize(w));return{args:u,transferables:y.length===0?y:b(y)}}function S(d,u){return(...y)=>{const w=l++,{args:h,transferables:E}=k(y),M={type:c.MasterMessageType.run,uid:w,method:u,args:h};o("Sending command to run function to worker:",M);try{d.postMessage(M,E)}catch(g){return t.ObservablePromise.from(Promise.reject(g))}return t.ObservablePromise.from(a.multicast(_(d,w)))}}e.createProxyFunction=S;function v(d,u){const y={};for(const w of u)y[w]=S(d,w);return y}e.createProxyModule=v}}),tt=P({"node_modules/threads/dist/master/spawn.js"(e){var i=e&&e.__awaiter||function(h,E,M,g){function C(T){return T instanceof M?T:new M(function(A){A(T)})}return new(M||(M=Promise))(function(T,A){function j(F){try{I(g.next(F))}catch(D){A(D)}}function L(F){try{I(g.throw(F))}catch(D){A(D)}}function I(F){F.done?T(F.value):C(F.value).then(j,L)}I((g=g.apply(h,E||[])).next())})},s=e&&e.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(e,"__esModule",{value:!0}),e.spawn=void 0;var a=s(ce()),n=K(),t=$(),r=Xe(),c=Y(),o=Ke(),l=et(),b=a.default("threads:master:messages"),m=a.default("threads:master:spawn"),p=a.default("threads:master:thread-utils"),f=h=>h&&h.type==="init",_=h=>h&&h.type==="uncaughtError",k=typeof process<"u"&&oe.THREADS_WORKER_INIT_TIMEOUT?Number.parseInt(oe.THREADS_WORKER_INIT_TIMEOUT,10):1e4;function S(h,E,M){return i(this,void 0,void 0,function*(){let g;const C=new Promise((A,j)=>{g=setTimeout(()=>j(Error(M)),E)}),T=yield Promise.race([h,C]);return clearTimeout(g),T})}function v(h){return new Promise((E,M)=>{const g=C=>{b("Message from worker before finishing initialization:",C.data),f(C.data)?(h.removeEventListener("message",g),E(C.data)):_(C.data)&&(h.removeEventListener("message",g),M(t.deserialize(C.data.error)))};h.addEventListener("message",g)})}function d(h,E){return new n.Observable(M=>{const g=T=>{const A={type:o.WorkerEventType.message,data:T.data};M.next(A)},C=T=>{p("Unhandled promise rejection event in thread:",T);const A={type:o.WorkerEventType.internalError,error:Error(T.reason)};M.next(A)};h.addEventListener("message",g),h.addEventListener("unhandledrejection",C),E.then(()=>{const T={type:o.WorkerEventType.termination};h.removeEventListener("message",g),h.removeEventListener("unhandledrejection",C),M.next(T),M.complete()})})}function u(h){const[E,M]=r.createPromiseWithResolver();return{terminate:()=>i(this,void 0,void 0,function*(){p("Terminating worker"),yield h.terminate(),M()}),termination:E}}function y(h,E,M,g){const C=M.filter(T=>T.type===o.WorkerEventType.internalError).map(T=>T.error);return Object.assign(h,{[c.$errors]:C,[c.$events]:M,[c.$terminate]:g,[c.$worker]:E})}function w(h,E){return i(this,void 0,void 0,function*(){m("Initializing new thread");const M=E&&E.timeout?E.timeout:k,C=(yield S(v(h),M,`Timeout: Did not receive an init message from worker after ${M}ms. Make sure the worker calls expose().`)).exposed,{termination:T,terminate:A}=u(h),j=d(h,T);if(C.type==="function"){const L=l.createProxyFunction(h);return y(L,h,j,A)}else if(C.type==="module"){const L=l.createProxyModule(h,C.methods);return y(L,h,j,A)}else{const L=C.type;throw Error(`Worker init message states unexpected type of expose(): ${L}`)}})}e.spawn=w}}),rt=P({"node_modules/threads/dist/master/index.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Worker=e.BlobWorker=e.isWorkerRuntime=e.Thread=e.spawn=e.Pool=void 0;var i=ge();Object.defineProperty(e,"isWorkerRuntime",{enumerable:!0,get:function(){return i.isWorkerRuntime}});var s=Ze();Object.defineProperty(e,"Pool",{enumerable:!0,get:function(){return s.Pool}});var a=tt();Object.defineProperty(e,"spawn",{enumerable:!0,get:function(){return a.spawn}});var n=_e();Object.defineProperty(e,"Thread",{enumerable:!0,get:function(){return n.Thread}}),e.BlobWorker=i.getWorkerImplementation().blob,e.Worker=i.getWorkerImplementation().default}}),nt=P({"node_modules/is-observable/index.js"(e,i){i.exports=s=>s?typeof Symbol.observable=="symbol"&&typeof s[Symbol.observable]=="function"?s===s[Symbol.observable]():typeof s["@@observable"]=="function"?s===s["@@observable"]():!1:!1}}),st=P({"node_modules/threads/dist/worker/implementation.browser.js"(e){Object.defineProperty(e,"__esModule",{value:!0});var i=function(){const t=typeof self<"u"&&typeof Window<"u"&&self instanceof Window;return!!(typeof self<"u"&&self.postMessage&&!t)},s=function(t,r){self.postMessage(t,r)},a=function(t){const r=o=>{t(o.data)},c=()=>{self.removeEventListener("message",r)};return self.addEventListener("message",r),c};e.default={isWorkerRuntime:i,postMessageToMaster:s,subscribeToMasterMessages:a}}}),ot=P({"node_modules/threads/dist/worker/index.js"(e){var i=e&&e.__awaiter||function(g,C,T,A){function j(L){return L instanceof T?L:new T(function(I){I(L)})}return new(T||(T=Promise))(function(L,I){function F(W){try{re(A.next(W))}catch(ne){I(ne)}}function D(W){try{re(A.throw(W))}catch(ne){I(ne)}}function re(W){W.done?L(W.value):j(W.value).then(F,D)}re((A=A.apply(g,C||[])).next())})},s=e&&e.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(e,"__esModule",{value:!0}),e.expose=e.isWorkerRuntime=e.Transfer=e.registerSerializer=void 0;var a=s(nt()),n=$(),t=J(),r=Se(),c=s(st()),o=$();Object.defineProperty(e,"registerSerializer",{enumerable:!0,get:function(){return o.registerSerializer}});var l=J();Object.defineProperty(e,"Transfer",{enumerable:!0,get:function(){return l.Transfer}}),e.isWorkerRuntime=c.default.isWorkerRuntime;var b=!1,m=new Map,p=g=>g&&g.type===r.MasterMessageType.cancel,f=g=>g&&g.type===r.MasterMessageType.run,_=g=>a.default(g)||k(g);function k(g){return g&&typeof g=="object"&&typeof g.subscribe=="function"}function S(g){return t.isTransferDescriptor(g)?{payload:g.send,transferables:g.transferables}:{payload:g,transferables:void 0}}function v(){const g={type:r.WorkerMessageType.init,exposed:{type:"function"}};c.default.postMessageToMaster(g)}function d(g){const C={type:r.WorkerMessageType.init,exposed:{type:"module",methods:g}};c.default.postMessageToMaster(C)}function u(g,C){const{payload:T,transferables:A}=S(C),j={type:r.WorkerMessageType.error,uid:g,error:n.serialize(T)};c.default.postMessageToMaster(j,A)}function y(g,C,T){const{payload:A,transferables:j}=S(T),L={type:r.WorkerMessageType.result,uid:g,complete:C?!0:void 0,payload:A};c.default.postMessageToMaster(L,j)}function w(g,C){const T={type:r.WorkerMessageType.running,uid:g,resultType:C};c.default.postMessageToMaster(T)}function h(g){try{const C={type:r.WorkerMessageType.uncaughtError,error:n.serialize(g)};c.default.postMessageToMaster(C)}catch(C){console.error(`Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.
Latest error:`,C,`
Original error:`,g)}}function E(g,C,T){return i(this,void 0,void 0,function*(){let A;try{A=C(...T)}catch(L){return u(g,L)}const j=_(A)?"observable":"promise";if(w(g,j),_(A)){const L=A.subscribe(I=>y(g,!1,n.serialize(I)),I=>{u(g,n.serialize(I)),m.delete(g)},()=>{y(g,!0),m.delete(g)});m.set(g,L)}else try{const L=yield A;y(g,!0,n.serialize(L))}catch(L){u(g,n.serialize(L))}})}function M(g){if(!c.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(b)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(b=!0,typeof g=="function")c.default.subscribeToMasterMessages(C=>{f(C)&&!C.method&&E(C.uid,g,C.args.map(n.deserialize))}),v();else if(typeof g=="object"&&g){c.default.subscribeToMasterMessages(T=>{f(T)&&T.method&&E(T.uid,g[T.method],T.args.map(n.deserialize))});const C=Object.keys(g).filter(T=>typeof g[T]=="function");d(C)}else throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${g}`);c.default.subscribeToMasterMessages(C=>{if(p(C)){const T=C.uid,A=m.get(T);A&&(A.unsubscribe(),m.delete(T))}})}e.expose=M,typeof self<"u"&&typeof self.addEventListener=="function"&&c.default.isWorkerRuntime()&&(self.addEventListener("error",g=>{setTimeout(()=>h(g.error||g),250)}),self.addEventListener("unhandledrejection",g=>{const C=g.reason;C&&typeof C.message=="string"&&setTimeout(()=>h(C),250)})),typeof process<"u"&&typeof process.on=="function"&&c.default.isWorkerRuntime()&&(process.on("uncaughtException",g=>{setTimeout(()=>h(g),250)}),process.on("unhandledRejection",g=>{g&&typeof g.message=="string"&&setTimeout(()=>h(g),250)}))}}),it=P({"node_modules/threads/dist/index.js"(e){var i=e&&e.__createBinding||(Object.create?function(c,o,l,b){b===void 0&&(b=l),Object.defineProperty(c,b,{enumerable:!0,get:function(){return o[l]}})}:function(c,o,l,b){b===void 0&&(b=l),c[b]=o[l]}),s=e&&e.__exportStar||function(c,o){for(var l in c)l!=="default"&&!Object.prototype.hasOwnProperty.call(o,l)&&i(o,c,l)};Object.defineProperty(e,"__esModule",{value:!0}),e.Transfer=e.DefaultSerializer=e.expose=e.registerSerializer=void 0;var a=$();Object.defineProperty(e,"registerSerializer",{enumerable:!0,get:function(){return a.registerSerializer}}),s(rt(),e);var n=ot();Object.defineProperty(e,"expose",{enumerable:!0,get:function(){return n.expose}});var t=be();Object.defineProperty(e,"DefaultSerializer",{enumerable:!0,get:function(){return t.DefaultSerializer}});var r=J();Object.defineProperty(e,"Transfer",{enumerable:!0,get:function(){return r.Transfer}})}}),z=P({"build/dispatcher.js"(e,i){var{spawn:s,Thread:a,Worker:n}=it(),t=typeof process=="object"&&process+""=="[object process]",r=class{constructor(){this.worker=null,this.workerPath=null}setWorkerPath(o){this.workerPath=o}getWorkerPath(){if(this.workerPath)return this.workerPath;if(t)return"./kuzu_wasm_worker.js";const o=import.meta.url;return`${o.substring(0,o.lastIndexOf("/"))}/kuzu_wasm_worker.js`}async init(){const o=this.getWorkerPath();this.worker=await s(new n(o),{timeout:6e4});const l=await this.worker.init();if(l.isSuccess)return l;throw new Error(l.error)}async close(){this.worker&&await a.terminate(this.worker)}async getWorker(){return this.worker||(this.workerInitPromise||(this.workerInitPromise=this.init()),await this.workerInitPromise,delete this.workerInitPromise),this.worker}},c=new r;i.exports=c}}),at=P({"build/database.js"(e,i){var s=z(),a=class{constructor(n,t=0,r=0,c=!0,o=!1,l=!0,b=16777216){this._isInitialized=!1,this._initPromise=null,this._id=null,this._isClosed=!1,this.databasePath=n,this.bufferPoolSize=t,this.maxNumThreads=r,this.enableCompression=c,this.readOnly=o,this.autoCheckpoint=l,this.checkpointThreshold=b}async init(){this._isInitialized||this._initPromise||(this._initPromise=(async()=>{const t=await(await s.getWorker()).databaseConstruct(this.databasePath,this.bufferPoolSize,this.maxNumThreads,this.enableCompression,this.readOnly,this.autoCheckpoint,this.checkpointThreshold);if(t.isSuccess)this._id=t.id,this._isInitialized=!0;else throw new Error(t.error)})()),await this._initPromise,this._initPromise=null}async _getDatabaseObjectId(){if(this._isClosed)throw new Error("Database is closed.");return this._isInitialized||await this.init(),this._id}async close(){this._isClosed||(await(await s.getWorker()).databaseClose(this._id),this._isClosed=!0)}};i.exports=a}}),Ee=P({"build/query_result.js"(e,i){var s=z(),a=class Ce{constructor(t){this._id=t,this._isClosed=!1,this._hasNext=void 0,this._hasNextQueryResult=void 0,this._isSuccess=void 0}async _syncValues(){if(this._isClosed)return;const t=await s.getWorker();let r=await t.queryResultHasNext(this._id);if(r.isSuccess)this._hasNext=r.result;else throw new Error(r.error);if(r=await t.queryResultHasNextQueryResult(this._id),r.isSuccess)this._hasNextQueryResult=r.result;else throw new Error(r.error);if(r=await t.queryResultIsSuccess(this._id),r.isSuccess)this._isSuccess=r.result;else throw new Error(r.error)}isSuccess(){return this._isSuccess}async getErrorMessage(){const r=await(await s.getWorker()).queryResultGetErrorMessage(this._id);if(r.isSuccess)return r.result;throw new Error(r.error)}async resetIterator(){const r=await(await s.getWorker()).queryResultResetIterator(this._id);if(!r.isSuccess)throw new Error(r.error);await this._syncValues()}hasNext(){return this._hasNext}hasNextQueryResult(){return this._hasNextQueryResult}async getNumColumns(){const r=await(await s.getWorker()).queryResultGetNumColumns(this._id);if(r.isSuccess)return r.result;throw new Error(r.error)}async getNumTuples(){const r=await(await s.getWorker()).queryResultGetNumTuples(this._id);if(r.isSuccess)return r.result;throw new Error(r.error)}async getColumnNames(){const r=await(await s.getWorker()).queryResultGetColumnNames(this._id);if(r.isSuccess)return r.result;throw new Error(r.error)}async getColumnTypes(){const r=await(await s.getWorker()).queryResultGetColumnTypes(this._id);if(r.isSuccess)return r.result;throw new Error(r.error)}async toString(){const r=await(await s.getWorker()).queryResultToString(this._id);if(r.isSuccess)return r.result;throw new Error(r.error)}async getQuerySummary(){const r=await(await s.getWorker()).queryResultGetQuerySummary(this._id);if(r.isSuccess)return r.result;throw new Error(r.error)}async getNextQueryResult(){const r=await(await s.getWorker()).queryResultGetNextQueryResult(this._id);if(r.isSuccess){const c=r.result,o=new Ce(c);return await o._syncValues(),o}else throw new Error(r.error)}async getNext(){const r=await(await s.getWorker()).queryResultGetNext(this._id);if(r.isSuccess)return await this._syncValues(),r.result;throw new Error(r.error)}async getAllRows(){const r=await(await s.getWorker()).queryResultGetAllRows(this._id);if(r.isSuccess)return await this._syncValues(),r.result;throw new Error(r.error)}async getAllObjects(){const r=await(await s.getWorker()).queryResultGetAllObjects(this._id);if(r.isSuccess)return await this._syncValues(),r.result;throw new Error(r.error)}async close(){this._isClosed||(await(await s.getWorker()).queryResultClose(this._id),this._isClosed=!0)}};i.exports=a}}),Me=P({"build/prepared_statement.js"(e,i){var s=z(),a=class{constructor(n){this._id=n,this._isClosed=!1,this._isSuccess=void 0}async _syncValues(){if(this._isClosed)return;let t=await(await s.getWorker()).preparedStatementIsSuccess(this._id);if(t.isSuccess)this._isSuccess=t.result;else throw new Error(t.error)}isSuccess(){return this._isSuccess}async getErrorMessage(){const t=await(await s.getWorker()).preparedStatementGetErrorMessage(this._id);if(t.isSuccess)return t.result;throw new Error(t.error)}async close(){this._isClosed||(await(await s.getWorker()).preparedStatementClose(this._id),this._isClosed=!0)}};i.exports=a}}),ct=P({"build/connection.js"(e,i){var s=z(),a=Ee(),n=Me(),t=class{constructor(r,c=null){this._isInitialized=!1,this._initPromise=null,this._id=null,this._isClosed=!1,this._database=r,this.numThreads=c}async init(){this._isInitialized||(this._initPromise||(this._initPromise=(async()=>{const r=await this._database._getDatabaseObjectId(),o=await(await s.getWorker()).connectionConstruct(r,this.numThreads);if(o.isSuccess)this._id=o.id,this._isInitialized=!0;else throw new Error(o.error)})()),await this._initPromise,this._initPromise=null)}async _getConnectionObjectId(){if(this._isClosed)throw new Error("Connection is closed.");return this._isInitialized||await this.init(),this._id}async setMaxNumThreadForExec(r){const c=await this._getConnectionObjectId(),l=await(await s.getWorker()).connectionSetMaxNumThreadForExec(c,r);if(!l.isSuccess)throw new Error(l.error)}async setQueryTimeout(r){const c=await this._getConnectionObjectId(),l=await(await s.getWorker()).connectionSetQueryTimeout(c,r);if(!l.isSuccess)throw new Error(l.error)}async getMaxNumThreadForExec(){const r=await this._getConnectionObjectId(),o=await(await s.getWorker()).connectionGetMaxNumThreadForExec(r);if(!o.isSuccess)throw new Error(o.error);return o.numThreads}async query(r){const c=await this._getConnectionObjectId(),l=await(await s.getWorker()).connectionQuery(c,r);if(!l.isSuccess)throw new Error(l.error);const b=new a(l.id);return await b._syncValues(),b}async prepare(r){const c=await this._getConnectionObjectId(),l=await(await s.getWorker()).connectionPrepare(c,r);if(!l.isSuccess)throw new Error(l.error);const b=new n(l.id);return await b._syncValues(),b}async execute(r,c={}){const o=await this._getConnectionObjectId(),b=await(await s.getWorker()).connectionExecute(o,r._id,c);if(!b.isSuccess)throw new Error(b.error);const m=new a(b.id);return await m._syncValues(),m}async close(){if(!this._isClosed){const r=await this._getConnectionObjectId();await(await s.getWorker()).connectionClose(r),this._isClosed=!0}}};i.exports=t}}),lt=P({"build/fs.js"(e,i){var s=z(),a=class{constructor(){}async readFile(n){const r=await(await s.getWorker()).FSReadFile(n);if(r.isFail)throw new Error(r.error);return r}async writeFile(n,t){const c=await(await s.getWorker()).FSWriteFile(n,t);if(!c.isSuccess)throw new Error(c.error)}async mkdir(n){const r=await(await s.getWorker()).FSMkdir(n);if(!r.isSuccess)throw new Error(r.error)}async unlink(n){const r=await(await s.getWorker()).FSUnlink(n);if(!r.isSuccess)throw new Error(r.error)}async rename(n,t){const c=await(await s.getWorker()).FSRename(n,t);if(!c.isSuccess)throw new Error(c.error)}async rmdir(n){const r=await(await s.getWorker()).FSRmdir(n);if(!r.isSuccess)throw new Error(r.error)}async stat(n){const r=await(await s.getWorker()).FSStat(n);if(r.isSuccess)return r.result;throw new Error(r.error)}async readDir(n){const r=await(await s.getWorker()).FSReadDir(n);if(r.isSuccess)return r.result;throw new Error(r.error)}async mountIdbfs(n){const r=await(await s.getWorker()).FSMountIdbfs(n);if(!r.isSuccess)throw new Error(r.error)}async unmount(n){const r=await(await s.getWorker()).FSUnmount(n);if(!r.isSuccess)throw new Error(r.error)}async syncfs(n){const r=await(await s.getWorker()).FSSyncfs(n);if(!r.isSuccess)throw new Error(r.error)}};i.exports=new a}}),ut=P({"build/index.js"(e,i){var s=z(),a=at(),n=ct(),t=Me(),r=Ee(),c=lt();i.exports={init:async()=>{await s.init()},getVersion:async()=>await(await s.getWorker()).getVersion(),getStorageVersion:async()=>await(await s.getWorker()).getStorageVersion(),setWorkerPath:o=>{s.setWorkerPath(o)},close:async()=>{await s.close()},Database:a,Connection:n,PreparedStatement:t,QueryResult:r,FS:c}}});const se=ut(),dt=(e,i)=>e==="archimate:Junction"?i=="or"?"OrJunction":"AndJunction":e.replace("archimate:",""),ft=e=>[].map.call(e.querySelectorAll('model > folder:not([type="relations"],[type="diagrams"]) element'),s=>({id:s.getAttribute("id"),type:dt(s.getAttribute("xsi:type"),s.getAttribute("type")),name:s.getAttribute("name")?s.getAttribute("name"):"",documentation:s.querySelector("documentation")?s.querySelector("documentation").textContent:"",properties:[].map.call(s.querySelectorAll("property"),a=>({name:a.getAttribute("key")??"",value:a.getAttribute("value")??""})).reduce((a,n)=>(a[n.name.toLowerCase()]=n.value,a),{})})),mt={1:"Read",2:"Write",3:"ReadWrite"},ht=e=>[].map.call(e.querySelectorAll('folder[type="relations"] element'),s=>({id:s.getAttribute("id"),type:s.getAttribute("xsi:type").replace("archimate:","").replace("Relationship",""),name:s.getAttribute("name")?s.getAttribute("name"):"",documentation:s.querySelector("documentation")?s.querySelector("documentation").textContent:"",source:s.getAttribute("source"),target:s.getAttribute("target"),accessType:mt[s.getAttribute("accessType")]??null,properties:[].map.call(s.querySelectorAll("property"),a=>({name:a.getAttribute("key"),value:a.getAttribute("value")})).reduce((a,n)=>(a[n.name.toLowerCase()]=n.value,a),{})})),pt=e=>{const i=e.querySelector("model").getAttribute("name"),s=e.querySelector("model > purpose")?e.querySelector("model > purpose").textContent:"",a=ft(e),n=ht(e);return{modelName:i,modelDocumentation:s,nodes:a,links:n}};function yt(e){const i=e.querySelectorAll("model > propertyDefinitions > propertyDefinition");(!i||i.length===0)&&console.warn("No propertyDefinition tags found under <model><propertyDefinitions>");const s=Array.from(i).reduce((a,n)=>{const t=n.getAttribute("identifier"),r=n.querySelector("name"),c=r?r.textContent:"unknown";return a[t]=c,a},{});return console.log(" propertyDefinitionsMap:",s),s}function bt(e,i){const s=e.querySelector("model > elements");if(!s)return console.warn("No <elements> container found under <model>."),[];const a=s.querySelectorAll("element");console.log(` Found ${a.length} <element> tags under <model><elements>.`);const n=Array.from(a).filter(t=>{const r=t.getAttribute("xsi:type")||t.getAttribute("type");return!(r!=null&&r.includes("ArchimateDiagramModel"))}).map(t=>{const r=t.getAttribute("identifier")||"no-id",c=t.getAttribute("xsi:type")||t.getAttribute("type")||"Element",o=t.querySelector("name"),l=t.querySelector("documentation"),b={};return t.querySelectorAll("property").forEach(m=>{const p=m.getAttribute("propertyDefinitionRef"),f=i[p]||"unknown",_=m.querySelector("value");b[f.toLowerCase()]=_?_.textContent:""}),{id:r,type:c,name:o?o.textContent:"",documentation:l?l.textContent:"",properties:b}});return console.log(" Parsed Nodes:",n),n}function gt(e,i){const s=e.querySelector("model > relationships");if(!s)return console.warn("No <relationships> container found under <model>."),[];const a=s.querySelectorAll("relationship");console.log(` Found ${a.length} <relationship> tags under <model><relationships>.`);const n=Array.from(a).map(t=>{var f,_;const r=t.getAttribute("identifier")||"no-rel-id",c=t.getAttribute("xsi:type")||t.getAttribute("type")||"Relationship",o=t.querySelector("name"),l=t.querySelector("documentation"),b=((f=t.getAttribute("source"))==null?void 0:f.trim())||null,m=((_=t.getAttribute("target"))==null?void 0:_.trim())||null,p={};return t.querySelectorAll("property").forEach(k=>{const S=k.getAttribute("propertyDefinitionRef"),v=i[S]||"unknown",d=k.querySelector("value");p[v.toLowerCase()]=d?d.textContent:""}),{id:r,type:c,name:o?o.textContent:"",documentation:l?l.textContent:"",source:b,target:m,properties:p}});return console.log(" Parsed Links:",n),n}function wt(e){const i=e.querySelector("model");if(!i)return console.warn("No <model> element found in the XML."),{modelName:"Unnamed Model",modelDocumentation:"",nodes:[],links:[]};const s=i.querySelector("name"),a=i.querySelector("documentation"),n=s?s.textContent:"Unnamed Model",t=a?a.textContent:"",r=yt(e),c=bt(e,r),o=gt(e,r);return console.log(" Final Graph Data JSON:",{modelName:n,modelDocumentation:t,nodesCount:c.length,linksCount:o.length}),{modelName:n,modelDocumentation:t,nodes:c,links:o}}const U="archiGraphDataStore";let he=null,G=null;const Q=(async()=>(await se.init(),he=new se.Database,G=new se.Connection(he),console.log("Kzu in-memory DB created successfully."),await G.query(`
    CREATE NODE TABLE IF NOT EXISTS Element(
      id STRING PRIMARY KEY,
      layer STRING,
      type STRING,
      name STRING
    );
  `),await G.query(`
    CREATE REL TABLE IF NOT EXISTS Relationship(
      FROM Element TO Element,
      type STRING
    );
  `),console.log("Kzu 'Element' & 'Relationship' tables ready."),G))();function vt(e){if(e.querySelector('folder[type="elements"]')||e.querySelector('folder[type="relations"]'))return console.log("Detected Archi .archimate file -> Archi parser."),pt(e);const i=e.querySelector("model > elements"),s=e.querySelector("model > relationships");if(i&&s)return console.log("Detected ArchiMate Exchange Format -> Exchange parser."),wt(e);throw new Error("Could not detect Archi/Exchange file format from XML.")}async function le(e,i){var s;try{const a=await Q;if(!a)throw new Error("Kzu connection not established.");const n=new DOMParser().parseFromString(e,"text/xml"),t=vt(n);if(!((s=t.nodes)!=null&&s.length))throw new Error("Parsed data is empty or missing relationships.");sessionStorage.setItem(U,JSON.stringify(t)),console.log("Clearing old data from Kzu..."),await a.query("MATCH (n:Element) DELETE n;"),await a.query("MATCH ()-[r:Relationship]->() DELETE r;"),console.log("Inserting new data into Kzu...");for(const r of t.nodes){const c=(r.id||"").replace(/'/g,"\\'"),o=(r.type||"").replace(/'/g,"\\'"),l=(r.name||"").replace(/'/g,"\\'");let b="Business";if(r.layer&&r.layer.trim().length>0)b=r.layer;else if(r.type){const p=r.type.toLowerCase();p.includes("business")?b="Business":p.includes("application")?b="Application":p.includes("technology")&&(b="Technology")}const m=`
        CREATE (:Element {
          id: '${c}',
          layer: '${b}',
          type: '${o}',
          name: '${l}'
        });
      `;await a.query(m)}for(const r of t.links){const c=(r.type&&r.type.trim()?r.type:"Unknown").replace(/'/g,"\\'"),o=(r.source||"").replace(/'/g,"\\'"),l=(r.target||"").replace(/'/g,"\\'");if(!o||!l)continue;const b=`
        MATCH (a:Element {id: '${o}'}), (b:Element {id: '${l}'})
        CREATE (a)-[:Relationship {type: '${c}'}]->(b);
      `;await a.query(b)}console.log("Data inserted into Kzu successfully."),typeof i=="function"&&i()}catch(a){throw console.error("Error processing model file & inserting into Kzu:",a),a}}async function ee(e,i){try{await Q;const s=await fetch(e);if(!s.ok)throw new Error(s.statusText);const a=await s.text();await le(a,i)}catch(s){console.error("Error retrieving model file:",s)}}function Te(){return!!sessionStorage.getItem(U)}function ue(){const e=sessionStorage.getItem(U);return e?JSON.parse(e):{nodes:[],links:[]}}function Ae(){sessionStorage.removeItem(U)}function Pe(){const e=ue();return{modelName:e.modelName||"No Model Name",modelDocumentation:e.modelDocumentation||""}}function B(e){return e!=null&&e.length?`[${e.map(s=>`'${s}'`).join(",")}]`:"[]"}async function _t(e,i,s){try{const a=await Q;if(!a)throw new Error("Kzu DB not ready.");const n=`
      MATCH (n:Element {id: $rootNodeId})
      MATCH (n)-[r:Relationship]-(m:Element)
      RETURN collect(n) + collect(m) AS nodes, collect(r) AS links;
    `;console.log("Neighborhood Query:",n);const c=(await(await a.query(n,{rootNodeId:e})).getAllObjects())[0]||{nodes:[],links:[]};typeof s=="function"&&s(c)}catch(a){console.error("Error in neighborhood query:",a),alert("Error in neighborhood query: "+a.message)}}async function kt(e){const i=e.getAllObjects?await e.getAllObjects():e,s=new Map,a=[];for(const n of i){let t=typeof n.getValue=="function"?n.getValue(0):n;if(t&&t._NODES&&t._RELS){t._NODES.forEach(r=>s.set(r.id,r));for(let r=0;r<t._RELS.length;r++){const c=t._NODES[r],o=t._NODES[r+1];c&&o&&a.push({source:c.id,target:o.id,type:t._RELS[r].type})}}else console.warn("Row does not contain a valid path object:",n)}return{nodes:Array.from(s.values()),links:a}}async function de(e){try{let k=function(S,v){return typeof v=="bigint"?v.toString():v};const i=await Q;if(!i)throw new Error("Kzu DB not ready.");const s=document.querySelectorAll(".layerCheckbox:checked"),a=s.length?Array.from(s).map(S=>S.value):[],n=a.length?"a.layer IN "+B(a)+" AND b.layer IN "+B(a):"true",t=document.querySelectorAll(".facet-value:not([data-group='relationships']):checked"),r=t.length?Array.from(t).map(S=>S.value):[],c=r.length?"a.type IN "+B(r)+" AND b.type IN "+B(r):"true",o=document.querySelectorAll(".facet-value[data-group='relationships']:checked"),l=o.length?Array.from(o).map(S=>S.value):[],b=l.length?"r.type IN "+B(l):"false",p=`
      MATCH (a:Element)-[r:Relationship]->(b:Element)
      WHERE ${`${n} AND ${c} AND ${b}`}
      RETURN a, r, b
      LIMIT 1000
    `;console.log("Global Filter Query:",p);const f=await i.query(p),_=await Le(f);sessionStorage.setItem(U,JSON.stringify(_,k)),typeof e=="function"&&e(_)}catch(i){console.error("Error in global filtering:",i),alert("Error in global filtering: "+i.message)}}async function Le(e){if(!e||typeof e.getAllObjects!="function")return console.error("buildSubgraphFromRecords: queryResult.getAllObjects is not defined"),{nodes:[],links:[]};let i=await e.getAllObjects();(!i||!Array.isArray(i))&&(console.error("buildSubgraphFromRecords: rows is not an array",i),i=[]);const s=new Map,a=[];return i.forEach(n=>{const t=n.a||n.A,r=n.b||n.B,c=n.r||n.R;t&&t.id&&s.set(t.id,t),r&&r.id&&s.set(r.id,r),t&&r&&c&&c.type&&a.push({source:t.id,target:r.id,type:c.type})}),{nodes:Array.from(s.values()),links:a}}const St=Object.freeze(Object.defineProperty({__proto__:null,buildSubgraphFromPaths:kt,buildSubgraphFromRecords:Le,dataExistsInStore:Te,deleteDataFromStore:Ae,globalFilterGraph:de,kuzuNeighborhoodGraph:_t,kuzuReadyPromise:Q,modelOverview:Pe,processModelFile:le,requestDataFromServer:ee,requestDataFromStore:ue},Symbol.toStringTag,{value:"Module"})),Et="modulepreload",Ct=function(e){return"/"+e},pe={},Mt=function(i,s,a){let n=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),c=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));n=Promise.allSettled(s.map(o=>{if(o=Ct(o),o in pe)return;pe[o]=!0;const l=o.endsWith(".css"),b=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${b}`))return;const m=document.createElement("link");if(m.rel=l?"stylesheet":Et,l||(m.as="script"),m.crossOrigin="",m.href=o,c&&m.setAttribute("nonce",c),document.head.appendChild(m),l)return new Promise((p,f)=>{m.addEventListener("load",p),m.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})}))}function t(r){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=r,window.dispatchEvent(c),!c.defaultPrevented)throw r}return n.then(r=>{for(const c of r||[])c.status==="rejected"&&t(c.reason);return i().catch(t)})},fe="data/ArchiSurance.archimate",Tt={"Confidential (Red)":"#f00","Restricted (Amber)":"#ff8000","Limited Disclosure (Green)":"#00a400","Unlimited Disclosure (White)":"#fff"},je=e=>{switch(e){case"ApplicationComponent":case"ApplicationCollaboration":case"ApplicationEvent":case"ApplicationFunction":case"ApplicationInteraction":case"ApplicationInterface":case"ApplicationProcess":case"ApplicationService":case"DataObject":return"#b6f4f6";case"BusinessActor":case"BusinessCollaboration":case"BusinessEvent":case"BusinessFunction":case"BusinessInteraction":case"BusinessInterface":case"BusinessObject":case"BusinessProcess":case"BusinessRole":case"BusinessService":case"Contract":case"Product":case"Representation":case"Location":return"#ffffb1";case"Assessment":case"Constraint":case"Driver":case"Goal":case"Meaning":case"Outcome":case"Principle":case"Requirement":case"Stakeholder":case"Value":return"#ccf";case"DistributionNetwork":case"Equipment":case"Facility":case"Material":return"#d1f6c5";case"Artifact":case"CommunicationNetwork":case"Device":case"Node":case"Path":case"SystemSoftware":case"TechnologyCollaboration":case"TechnologyEvent":case"TechnologyFunction":case"TechnologyInteraction":case"TechnologyInterface":case"TechnologyProcess":case"TechnologyService":return"#d1f6c5";case"Capability":case"CourseOfAction":case"Resource":case"ValueStream":return"#f5deaa";case"Deliverable":case"Gap":case"ImplementationEvent":case"Plateau":case"WorkPackage":return"#ffe0e0"}return"#fefefe"},At=e=>{switch(e){case"ApplicationComponent":return"m -5 1 l 4 0 l 0 2 l -4 0 z m 0 -4 l 4 0 l 0 2 l -4 0 z m 2 0 l 0 -2 l 8 0 l 0 10 l -8 0 l 0 -2 m 0 -2 l 0 -2";case"Artifact":return"M 4 -1 V 5 H -4 V -5 H 0 L 3.35 -1.5 H 0 V -5";case"Assessment":return"m -3.5 -2 C -3.5 -8 5.5 -8 5.5 -2 C 5.5 4 -3.5 4 -3.5 -2 M -1 2 L -4 7";case"ApplicationCollaboration":case"BusinessCollaboration":case"TechnologyCollaboration":return"m -7 0 A 1 1 0 0 0 2 0 A 1 1 0 0 0 -7 0 M -2 0 A 1 1 0 0 0 7 0 A 1 1 0 0 0 -2 0";case"ApplicationEvent":case"BusinessEvent":case"TechnologyEvent":case"ImplementationEvent":return"m -5 -4 C -2 -3 -2 3 -5 4 H 3 C 6 3 6 -3 3 -4 H -5 M 3 -4";case"ApplicationFunction":case"BusinessFunction":case"TechnologyFunction":return"M -0.35 -5.2 L 4 -1 L 4 5 L 0 2 L -4 5 L -4 -1 L 0.35 -5.2";case"ApplicationInteraction":case"BusinessInteraction":case"TechnologyInteraction":return"m -1 -5 C -6 -4 -6 4 -1 5 Z M 1 -5 V -5 C 6 -4 6 4 1 5 Z";case"ApplicationInterface":case"BusinessInterface":case"TechnologyInterface":return"m -3 0 z c 0 -6 9 -6 9 0 C 6 6 -3 6 -3 0 H -8 z";case"ApplicationProcess":case"BusinessProcess":case"TechnologyProcess":return"m -5 -1.5 H 2 V -4 L 6 0 L 2 4 V 1.5 H -5 z";case"ApplicationService":case"BusinessService":case"TechnologyService":return"m -4 3 z c -4 0 -4 -6 0 -6 H 4 C 8 -3 8 3 4 3 z";case"BusinessActor":return"m 0 -2 A 1 1 0 0 0 0 -6 A 1 1 0 0 0 0 -2 V 3 M -3 6 L 0 3 M 3 6 L 0 3 M -3 0 H 3";case"BusinessRole":case"Stakeholder":return"m -4 -3 C -6 -3 -6 3 -4 3 H 4 C 6 3 6 -3 4 -3 H -4 M 4 -3 c -2 0 -2 6 0 6";case"BusinessObject":case"DataObject":return"m -5 -5 H 5 V 5 V 5 V 5 H -5 Z M -5 -3 H 5";case"Capability":return"m -4.5 4.5 h 9 v -9 h -3 v 9 m 3 -6 h -6 v 6 m 6 -3 h -9 v 3";case"CommunicationNetwork":return"m -4 -3 A 1 1 0 0 0 -1 -3 m 0 0 A 1 1 0 0 0 -4 -3 m 6 0 A 1 1 0 0 0 5 -3 A 1 1 0 0 0 2 -3 H -1 m -4 6 A 1 1 0 0 0 -2 3 A 1 1 0 0 0 -5 3 m 6 0 A 1 1 0 0 0 4 3 A 1 1 0 0 0 1 3 H -2 M -2.5 -1.5 L -3.5 1.5 M 3.5 -1.5 L 2.5 1.5";case"Constraint":return"m -4 -4 H 6 L 4 4 H -6 L -4 -4 M -3 4 L -1 -4";case"Contract":return"m -5 -5 H 5 V 5 V 5 V 5 H -5 Z M -5 -3 H 5 M -5 3 H 5";case"CourseOfAction":return"M -4 -1 A 1 1 0 0 0 6 -1 M 6 -1 A 1 1 0 0 0 -4 -1 M -2 -1 A 1 1 0 0 0 4 -1 A 1 1 0 0 0 -2 -1 M 0 -1 A 1 1 0 0 0 2 -1 A 1 1 0 0 0 0 -1 m 0.5 0 a 0.5 0.5 0 0 0 1 0 a 0.5 0.5 0 0 0 -1 0 m 0.5 0 m -6 3 L -2.5 2.5 L -3 5 Z M -6 5 Q -6 3 -4 3 L -3.5 4 Q -5 4 -5 6 Z";case"Deliverable":return"M -5 2 V -3.5 H 5 V 2 Q 2.5 0 0 2 Q -2.5 4 -5 2 Z";case"Device":return"M -3 2 L -5 5 H 5 L 3 2 H 4 C 5 2 5 2 5 1 V -4 C 5 -5 5 -5 4 -5 h -8 C -5 -5 -5 -5 -5 -4 V 1 C -5 2 -5 2 -4 2 H -3 H 3";case"Driver":return"M -5 0 A 1 1 0 0 0 5 0 M 5 0 A 1 1 0 0 0 -5 0 M -3 0 A 1 1 0 0 0 3 0 A 1 1 0 0 0 -3 0 M -1 0 A 1 1 0 0 0 1 0 A 1 1 0 0 0 -1 0 M -0.5 0 A 0.5 -0.5 0 0 0 0.5 0 A 0.5 0.5 0 0 0 -0.5 0";case"Gap":return"M -5 0 A 1 1 0 0 0 5 0 M 5 0 A 1 1 0 0 0 -5 0 M -6.3 1.5 H 6.3 M -6.3 -1.5 H 6.3";case"Goal":return"M -5 0 A 1 1 0 0 0 5 0 M 5 0 A 1 1 0 0 0 -5 0 M -3 0 A 1 1 0 0 0 3 0 A 1 1 0 0 0 -3 0 M -1 0 A 1 1 0 0 0 1 0 A 1 1 0 0 0 -1 0";case"Location":return"m 4 -1 C 6 -8 -6 -8 -4 -1 L 0 6 Z";case"Meaning":return"M -5 0 C -7 -1 -3 -5 -2 -3 C 0 -5 3 -4 2 -2 C 4 -3 6 -2 5 0 C 7 1 5 4 2 3 C 3 5 -3 5 -3 3 C -5 4 -6 2 -5 0 Z";case"Node":return"m -5 -3 V 5 h 8 v -8.5 h -7.32 l 2 -2 H 5 V 2 L 3.1 5.23 M 3 -3 L 5 -5";case"Outcome":return"M -5 0 A 1 1 0 0 0 5 0 M 5 0 A 1 1 0 0 0 -5 0 M -3 0 A 1 1 0 0 0 3 0 A 1 1 0 0 0 -3 0 M -1 0 A 1 1 0 0 0 1 0 A 1 1 0 0 0 -1 0 M -0.5 0 A 0.5 -0.5 0 0 0 0.5 0 A 0.5 0.5 0 0 0 -0.5 0 M 0 0 L 5.7 -5.7 M 4.5 -7 L 4.2 -4.2 L 7 -4.5";case"Path":return"m -3 4 L -6 0 L -3 -4 M 3 -4 L 6 0 L 3 4 M -3.2 -0.2 H -2.8 V 0.2 H -3.2 Z M -0.2 -0.2 H 0.2 V 0.2 H -0.2 Z M 2.8 -0.2 H 3.2 V 0.2 H 2.8 Z";case"Plateau":return"M -5 0 H 5 M -6 2.4 H 4 M -4 -2.4 H 6";case"Principle":return"M -5 -5 Q -5 -6 -4 -6 Q 0 -6 4 -6 Q 5 -6 5 -5 V 5 Q 5 6 4 6 H -4 Q -5 6 -5 5 Z M -0.35 1.5 V -4 H 0.35 V 1.5 Z M -0.35 3.35 V 4 H 0.35 V 3.35 Z";case"Product":return"m -5 -5 H 5 V 5 V 5 V 5 H -5 Z M -5 -3 H 0 V -5";case"Representation":return"m -5 -5 H 5 v 9 v 0 v 0 c -5 -3 -5 3 -10 0 Z M -5 -3 H 5";case"Requirement":return"m -4 -4 H 6 L 4 4 H -6 Z";case"Resource":return"M -6 -3 Q -6 -4 -5 -4 H 4 Q 5 -4 5 -3 V 3 Q 5 4 4 4 H -5 Q -6 4 -6 3 z m 11 5 A 1 1 0 0 0 6 1 V -1 A 1 1 0 0 0 5 -2 Z M -4 -2 H -4 V 2 M -2 -2 V 2 M 0 -2 V 2";case"SystemSoftware":return"m -6 1 Z c 0 -7 10 -7 10 0 c 0 7 -10 7 -10 0 z m 1 -3.3 c 4 -8.7 15 -1.7 8 6.6";case"Value":return"m -6 0 C -6 -6 6 -6 6 0 C 6 6 -6 6 -6 0";case"ValueStream":return"M 6 0 L 3 4 H -5 L -2 0 L -5 -4 H 3 Z";case"WorkPackage":return"M 3 2 V 0.5 L 5.2 2 L 3 3.5 V 2 H 3.4 V 1.4 L 4.2 2 L 3.4 2.6 V 2 M 3 2 H -2 A 3.4 3.4 0 1 1 0.4 1";case"AndJunction":case"OrJunction":return"M -5 0 A 1 1 0 0 0 5 0 M 5 0 A 1 1 0 0 0 -5 0"}return""},Pt=(e,i,s,a,n)=>{const r=s.append("g").attr("id","nodes").selectAll("g").data(a).enter().append("g").attr("id",o=>o.id).attr("class",o=>"element-"+o.type.toLowerCase()).classed("node-root",o=>!1);return r.append("circle").attr("r",10).attr("fill",o=>o.properties!==void 0&&o.properties.dataclassificationlevel!==void 0?Tt[o.properties.dataclassificationlevel]:je(o.type)).append("title").text(o=>{let l=o.name;return o.documentation!==void 0&&o.documentation.length>0&&(l+=" - "+o.documentation),l}),r.append("path").attr("d",o=>At(o.type)).attr("class","node-icon"),r.append("text").attr("class","node-label-type").attr("dx",o=>16).attr("dy",o=>-2).text(o=>{let l="("+o.type+")";return o.properties!==void 0&&o.properties.stereotype!==void 0&&(l+=" "+o.properties.stereotype+""),l}),r.append("text").attr("class","node-label-name").attr("dx",o=>16).attr("dy",o=>8).text(o=>o.name),r},Lt={colorForNodeType:je},ye=e=>{const i=e.append("defs"),s=10,a=10;i.append("marker").attr("id","relationship-arrow-open").attr("viewBox",[0,-8,20,20]).attr("refX",31).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",s).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("class","relationship-arrow-open"),i.append("marker").attr("id","relationship-arrow-open-read").attr("viewBox",[0,-8,20,20]).attr("refX",-21).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",s).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M10,-5L0,0L10,5").attr("class","relationship-arrow-open"),i.append("marker").attr("id","relationship-arrow-closed").attr("viewBox",[0,-8,20,20]).attr("refX",31).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",s).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("class","relationship-arrow-closed"),i.append("marker").attr("id","relationship-arrowlarge-open").attr("viewBox",[0,-8,20,20]).attr("refX",31).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",s).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M 0 0 L 0 -8 L 10 0 L 0 8 L 0 0").attr("class","relationship-arrowlarge-open"),i.append("marker").attr("id","relationship-diamond-open-start").attr("viewBox",[0,-8,22,22]).attr("refX",-23).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",s).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M 0 0 L 8 -6 L 16 0 L 8 6 L 0 0").attr("class","relationship-diamond-open"),i.append("marker").attr("id","relationship-diamond-closed-start").attr("viewBox",[0,-8,22,22]).attr("refX",-23).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",s).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M 0 0 L 8 -6 L 16 0 L 8 6 L 0 0").attr("class","relationship-diamond-closed"),i.append("marker").attr("id","relationship-circle-closed-start").attr("viewBox",[0,-8,22,22]).attr("refX",-23).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",s).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M 5, 0 m -5, 0 a 5,5 0 1,0 10,0 a 5,5 0 1,0 -10,0").attr("class","relationship-circle-closed")},jt=(e,i)=>{const s=e.append("g").attr("id","links").selectAll("line").data(i).enter().append("line").attr("id",a=>a.id).attr("class",a=>"relationship-"+a.type.toLowerCase()).attr("marker-start",a=>It(a)).attr("marker-end",a=>Ot(a));return s.append("title").text(a=>a.name),s},It=e=>{switch(e.type){case"Access":return e.accessType==="Read"||e.accessType==="ReadWrite"?"url(#relationship-arrow-open-read)":null;case"Aggregation":return"url(#relationship-diamond-open-start)";case"Composition":return"url(#relationship-diamond-closed-start)";case"Assignment":return"url(#relationship-circle-closed-start)"}},Ot=e=>{switch(e.type){case"Triggering":case"Assignment":case"Flow":return"url(#relationship-arrow-closed)";case"Influence":case"Serving":return"url(#relationship-arrow-open)";case"Access":return e.accessType==="Write"||e.accessType==="ReadWrite"?"url(#relationship-arrow-open)":null;case"Realization":case"Specialization":return"url(#relationship-arrowlarge-open)"}};function O(e){return typeof e=="object"&&e.id?e.id:e}function Ft(e,i,s,a){const n=i.filter(r=>{const c=O(r.source),o=O(r.target);return e.find(l=>l.id===c)&&e.find(l=>l.id===o)}),t=d3.forceSimulation(e).force("link",d3.forceLink(n).id(r=>r.id).distance(100).strength(.5)).force("charge",d3.forceManyBody().strength(-300)).force("center",d3.forceCenter(s/2,a/2));t.tick(300),t.stop()}function Ie(e,i,s,a,n){d3.selectAll("#graph-viewer").remove();const t=a.clientWidth,r=a.clientHeight,c=d3.select(a).append("svg").attr("id","graph-viewer").attr("width",t).attr("height",r);Ft(e,s,t,r),typeof ye=="function"&&ye(c);const o=c.append("g").attr("id","viewer"),l=s.filter(k=>e.find(S=>S.id===O(k.source))&&e.find(S=>S.id===O(k.target))),b=jt(o,l);function m(k,S,v="x"){const d=typeof k=="object"&&k.id?k.id:k,u=S.find(y=>y.id===d);return u?v==="x"?u.x:u.y:0}b.attr("x1",k=>m(k.source,e,"x")).attr("y1",k=>m(k.source,e,"y")).attr("x2",k=>m(k.target,e,"x")).attr("y2",k=>m(k.target,e,"y"));const p=Pt(t,r,o,e).attr("transform",k=>`translate(${k.x}, ${k.y})`);p.on("dblclick",function(k,S){k.stopPropagation();const v=parseInt(document.getElementById("depthSlider").value,10);document.getElementById("loading-message").style.display="block",Mt(()=>Promise.resolve().then(()=>St),void 0).then(d=>{d.kuzuNeighborhoodGraph(S.id,v,u=>{document.getElementById("loading-message").style.display="none",Ie(u.nodes,null,u.links,a)})})});const f=d3.drag().on("start",function(k,S){d3.select(this).classed("dragging-node",!0)}).on("drag",function(k,S){S.x=k.x,S.y=k.y,d3.select(this).attr("transform",`translate(${S.x}, ${S.y})`),b.filter(v=>O(v.source)===S.id||O(v.target)===S.id).attr("x1",v=>m(O(v.source),e,"x")).attr("y1",v=>m(O(v.source),e,"y")).attr("x2",v=>m(O(v.target),e,"x")).attr("y2",v=>m(O(v.target),e,"y"))}).on("end",function(k,S){d3.select(this).classed("dragging-node",!1)});p.call(f);const _=d3.zoom().on("zoom",k=>{o.attr("transform",k.transform)});c.call(_).on("dblclick.zoom",null),c.insert("rect",":first-child").attr("id","canvas-bg").attr("width",t).attr("height",r).attr("fill","transparent").on("click",()=>{p.selectAll("*").classed("highlighted",!1).classed("neighbor-highlight",!1),b.classed("link-highlight",!1)}),Rt(e,c)}function Rt(e,i){if(!e.length){i.attr("viewBox",`0 0 ${window.innerWidth} ${window.innerHeight}`);return}let s=1/0,a=1/0,n=-1/0,t=-1/0;e.forEach(c=>{c.x<s&&(s=c.x),c.y<a&&(a=c.y),c.x>n&&(n=c.x),c.y>t&&(t=c.y)});const r=20;i.attr("viewBox",`${s-r} ${a-r} ${n-s+2*r} ${t-a+2*r}`)}const ie="archiGraphUserSettings";let ae={userLoadedModel:!1,userLoadedModelFilename:"",stickyNodesOnDrag_Enabled:!0};const qt=e=>{localStorage.setItem(ie,JSON.stringify(e))},Z=()=>{let e=ae;return localStorage.getItem(ie)&&(e=JSON.parse(localStorage.getItem(ie))),e},me=e=>{let i=Z();return!(e in i)&&e in ae&&(q(e,ae[e]),i=Z()),i[e]},q=(e,i)=>{let s=Z();s[e]=i,qt(s)},Wt=()=>{const e=Z();if(e.userLoadedModel){const i=document.getElementById("userModelLoad-dragDrop-message");i.innerText=`Current loaded model: ${e.userLoadedModelFilename}`,document.getElementById("userModelLoad-delete").classList.remove("hidden")}document.getElementById("stickyNodesOnDrag").checked=me("stickyNodesOnDrag_Enabled"),document.getElementById("dialog-userSettings").showModal()},Oe=()=>{document.getElementById("dialog-userSettings").close(),document.getElementById("userModelLoad-dragDrop-message").innerText=""},Nt=(e,i)=>{var r;const s=((r=e.dataTransfer)==null?void 0:r.files)||e.target.files;if(!s||s.length===0){alert("No files were detected. Please try again.");return}const a=s[0];if(![".xml",".archimate"].some(c=>a.name.endsWith(c))){alert("Oops, it must be an .xml or .archimate file! Please ensure it is an ArchiMate Exchange Format or Archi file.");return}const n=document.getElementById("userModelLoad-dragDrop-message");n.innerText=`Loading: ${a.name}`;const t=new FileReader;t.onload=()=>{le(t.result,()=>{q("userLoadedModel",!0),q("userLoadedModelFilename",a.name),document.getElementById("userModelLoad-delete").classList.remove("hidden"),n.innerText=`The ${a.name} file has been loaded.`,typeof i=="function"&&i()})},t.readAsText(a)},zt=()=>{const e=me("userLoadedModelFilename");Ae();const i=document.getElementById("userModelLoad-dragDrop-message");i.innerText=`${e} has been deleted, the default model has been loaded`,q("userLoadedModel",!1),q("userLoadedModelFilename",""),document.getElementById("userModelLoad-delete").classList.add("hidden")},{colorForNodeType:Dt}=Lt;function x(e){return e.replace(/[<>&'"]/g,function(i){switch(i){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})}function Bt(e,i){const s={Capability:1,CourseOfAction:1,Resource:1,ValueStream:1,BusinessActor:2,BusinessCollaboration:2,BusinessEvent:2,BusinessFunction:2,BusinessInteraction:2,BusinessInterface:2,BusinessObject:2,BusinessProcess:2,BusinessRole:2,BusinessService:2,Contract:2,Product:2,Representation:2,ApplicationComponent:3,ApplicationCollaboration:3,ApplicationEvent:3,ApplicationFunction:3,ApplicationInteraction:3,ApplicationInterface:3,ApplicationProcess:3,ApplicationService:3,DataObject:3,Artifact:4,CommunicationNetwork:4,Device:4,Node:4,Path:4,SystemSoftware:4,TechnologyCollaboration:4,TechnologyEvent:4,TechnologyFunction:4,TechnologyInteraction:4,TechnologyInterface:4,TechnologyProcess:4,TechnologyService:4,"Distribution Network":5,Equipment:5,Facility:5,Material:5},a={};e.forEach(t=>{a[t.id]=t.type});let n=`<?xml version="1.0" encoding="utf-8"?>
`;return n+=`<graphml xmlns="http://graphml.graphdrawing.org/xmlns"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:y="http://www.yworks.com/xml/graphml"
    xsi:schemaLocation="http://graphml.graphdrawing.org/xmlns
      http://www.yworks.com/xml/schema/graphml/1.0/ygraphml.xsd">
`,n+=`  <key for="node" id="d0" yfiles.type="nodegraphics"/>
`,n+=`  <key attr.name="description" attr.type="string" for="node" id="d1"/>
`,n+=`  <key for="edge" id="d2" yfiles.type="edgegraphics"/>
`,n+=`  <key attr.name="description" attr.type="string" for="edge" id="d3"/>
`,n+=`  <graph id="G" edgedefault="directed">
`,e.forEach(t=>{const r=x(t.id),c=(t.name||"")+(t.type?` (${t.type})`:""),o=Dt(t.type),l=t.x!==void 0?parseFloat(t.x):0,b=t.y!==void 0?parseFloat(t.y):0,m=100,p=40;n+=`    <node id="${r}">
`,n+=`      <data key="d0">
`,n+=`        <y:ShapeNode>
`,n+=`          <y:Geometry x="${l}" y="${b}" width="${m}" height="${p}"/>
`,n+=`          <y:Fill color="${o}" transparent="false"/>
`,n+=`          <y:BorderStyle color="#000000" type="line" width="1.0"/>
`,n+=`          <y:NodeLabel alignment="center" autoSizePolicy="node_width" fontFamily="Dialog" fontSize="5" fontStyle="plain" textColor="#000000" visible="true" modelName="internal" modelPosition="c">
`,n+=`            ${x(c)}
`,n+=`          </y:NodeLabel>
`,n+=`          <y:Shape type="rectangle"/>
`,n+=`        </y:ShapeNode>
`,n+=`      </data>
`,n+=`    </node>
`}),i.forEach((t,r)=>{let c=typeof t.source=="object"?t.source.id:t.source,o=typeof t.target=="object"?t.target.id:t.target;const l=a[c],b=a[o];s[l]&&s[b]?s[l]>s[b]&&([c,o]=[o,c]):(t.type==="Realization"||t.type==="Serving")&&([c,o]=[o,c]);const m=`e${r}`;n+=`    <edge id="${x(m)}" source="${x(c)}" target="${x(o)}">
`,n+=`      <data key="d2">
`,n+=`        <y:PolyLineEdge>
`,n+=`          <y:LineStyle color="#000000" type="line" width="1.0"/>
`,n+=`          <y:Arrows source="none" target="standard"/>
`,n+=`          <y:BendStyle smoothed="true"/>
`,n+=`        </y:PolyLineEdge>
`,n+=`      </data>
`,n+=`    </edge>
`}),n+=`  </graph>
`,n+=`</graphml>
`,n}function xt(e,i){const s=new Blob([e],{type:"application/xml"}),a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=i,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}function Ht(){const e=sessionStorage.getItem("archiGraphDataStore");if(!e){alert("No graph data found in session storage.");return}const i=JSON.parse(e);let s=Array.isArray(i.nodes)?i.nodes:Object.values(i.nodes||{});const a=i.links||[],n={};s.forEach(c=>{n[c.id]=c}),a.forEach(c=>{const o=typeof c.source=="object"?c.source.id:c.source,l=typeof c.target=="object"?c.target.id:c.target;n[o]||(n[o]={id:o,name:o,type:"Undefined",x:0,y:0}),n[l]||(n[l]={id:l,name:l,type:"Undefined",x:0,y:0})}),s=Object.values(n);const t=Bt(s,a),r=(i.modelName||"graph")+".graphml";xt(t,r)}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("exportGraphMLButton");e&&e.addEventListener("click",Ht)});function $t(){const e=document.getElementById("applyFiltersBtn");e&&e.addEventListener("click",()=>{de(i=>{const s=new Event("kuzuFiltersDone");document.dispatchEvent(s)})})}let Vt=new URLSearchParams(window.location.search);function te(){const e=ue();document.getElementById("loading-message").style.display="none",console.log("Nodes:",e.nodes),console.log("Links:",e.links),Ie(e.nodes,null,e.links,document.getElementById("graph-container"))}function V(){te()}function Ut(){Vt.get("showheader"),document.querySelector("header").style.display="block",document.getElementById("action-userSettings").classList.remove("hidden"),document.getElementById("userSettings-userModelLoad").classList.remove("hidden")}function Qt(e,i){let s;return(...a)=>{clearTimeout(s),s=setTimeout(()=>e(...a),i)}}document.getElementById("action-reload").addEventListener("click",()=>{ee(fe,V)});document.getElementById("action-model-overview").addEventListener("click",()=>{const e=Pe();document.getElementById("model-name").innerText=e.modelName,document.getElementById("model-documentation").innerText=e.modelDocumentation,document.getElementById("dialog-overview").showModal()});document.getElementById("dialog-overview-close").addEventListener("click",()=>{document.getElementById("dialog-overview").close()});document.getElementById("dialog-overview-close-x").addEventListener("click",()=>{document.getElementById("dialog-overview").close()});document.getElementById("action-userSettings").addEventListener("click",()=>{Wt()});document.getElementById("dialog-userSettings-close").addEventListener("click",()=>{Oe()});document.getElementById("dialog-userSettings-close-x").addEventListener("click",()=>{Oe()});document.getElementById("userModelLoad-dragDrop-zone").addEventListener("dragover",e=>{e.preventDefault()});document.getElementById("userModelLoad-dragDrop-zone").addEventListener("drop",e=>{e.preventDefault(),Nt(e,V)});document.getElementById("userModelLoad-delete").addEventListener("click",()=>{zt(),ee(fe,V)});document.getElementById("stickyNodesOnDrag").addEventListener("change",function(){q("stickyNodesOnDrag_Enabled",this.checked)});$t();document.getElementById("applyFiltersBtn").addEventListener("click",async()=>{document.getElementById("loading-message").style.display="block",await de(e=>{document.getElementById("loading-message").style.display="none";const i=new Event("kuzuFiltersDone");document.dispatchEvent(i)})});window.onload=async()=>{Ut(),Te()||(q("userLoadedModel",!1),q("userLoadedModelFilename","")),me("userLoadedModel")?V():await ee(fe,V)};window.onresize=Qt(()=>{te()},100);window.onpopstate=()=>{te()};document.addEventListener("kuzuFiltersDone",()=>{console.log("Global filter applied => re-draw from session"),te()});
