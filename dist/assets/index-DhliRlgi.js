import{k as D}from"./kuzu-wasm-BP5yORNQ.js";import"./d3-transition-D-WDeqM-.js";import{z as ne}from"./d3-zoom-CTHwvTve.js";import{e as re,s as I}from"./d3-selection-Dub50jOu.js";import{a as oe}from"./d3-drag-Dv6F3X_l.js";import{s as G,l as X,m as j,c as Z,a as J,x as ae,y as se}from"./d3-force-jgf4i1vA.js";import"./d3-dispatch-kxCwF96_.js";import"./d3-timer-DdKHrDhs.js";import"./d3-interpolate-B6xYU604.js";import"./d3-color-9lF95FHy.js";import"./d3-ease-DRPgKoYJ.js";import"./d3-quadtree-CSANTnla.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(t){if(t.ep)return;t.ep=!0;const r=n(t);fetch(t.href,r)}})();const ie=(e,o)=>e==="archimate:Junction"?o=="or"?"OrJunction":"AndJunction":e.replace("archimate:",""),ce=e=>[].map.call(e.querySelectorAll('model > folder:not([type="relations"],[type="diagrams"]) element'),n=>({id:n.getAttribute("id"),type:ie(n.getAttribute("xsi:type"),n.getAttribute("type")),name:n.getAttribute("name")?n.getAttribute("name"):"",documentation:n.querySelector("documentation")?n.querySelector("documentation").textContent:"",properties:[].map.call(n.querySelectorAll("property"),a=>({name:a.getAttribute("key")??"",value:a.getAttribute("value")??""})).reduce((a,t)=>(a[t.name.toLowerCase()]=t.value,a),{})})),le={1:"Read",2:"Write",3:"ReadWrite"},de=e=>[].map.call(e.querySelectorAll('folder[type="relations"] element'),n=>({id:n.getAttribute("id"),type:n.getAttribute("xsi:type").replace("archimate:","").replace("Relationship",""),name:n.getAttribute("name")?n.getAttribute("name"):"",documentation:n.querySelector("documentation")?n.querySelector("documentation").textContent:"",source:n.getAttribute("source"),target:n.getAttribute("target"),accessType:le[n.getAttribute("accessType")]??null,properties:[].map.call(n.querySelectorAll("property"),a=>({name:a.getAttribute("key"),value:a.getAttribute("value")})).reduce((a,t)=>(a[t.name.toLowerCase()]=t.value,a),{})})),ue=e=>{const o=e.querySelector("model").getAttribute("name"),n=e.querySelector("model > purpose")?e.querySelector("model > purpose").textContent:"",a=ce(e),t=de(e);return{modelName:o,modelDocumentation:n,nodes:a,links:t}};function pe(e){const o=e.querySelectorAll("model > propertyDefinitions > propertyDefinition");(!o||o.length===0)&&console.warn("No propertyDefinition tags found under <model><propertyDefinitions>");const n=Array.from(o).reduce((a,t)=>{const r=t.getAttribute("identifier"),i=t.querySelector("name"),c=i?i.textContent:"unknown";return a[r]=c,a},{});return console.log("ðŸ”Ž propertyDefinitionsMap:",n),n}function me(e,o){const n=e.querySelector("model > elements");if(!n)return console.warn("No <elements> container found under <model>."),[];const a=n.querySelectorAll("element");console.log(`ðŸ”Ž Found ${a.length} <element> tags under <model><elements>.`);const t=Array.from(a).filter(r=>{const i=r.getAttribute("xsi:type")||r.getAttribute("type");return!(i!=null&&i.includes("ArchimateDiagramModel"))}).map(r=>{const i=r.getAttribute("identifier")||"no-id",c=r.getAttribute("xsi:type")||r.getAttribute("type")||"Element",s=r.querySelector("name"),u=r.querySelector("documentation"),y={};return r.querySelectorAll("property").forEach(m=>{const l=m.getAttribute("propertyDefinitionRef"),p=o[l]||"unknown",d=m.querySelector("value");y[p.toLowerCase()]=d?d.textContent:""}),{id:i,type:c,name:s?s.textContent:"",documentation:u?u.textContent:"",properties:y}});return console.log("âœ… Parsed Nodes:",t),t}function ge(e,o){const n=e.querySelector("model > relationships");if(!n)return console.warn("No <relationships> container found under <model>."),[];const a=n.querySelectorAll("relationship");console.log(`ðŸ”Ž Found ${a.length} <relationship> tags under <model><relationships>.`);const t=Array.from(a).map(r=>{var p,d;const i=r.getAttribute("identifier")||"no-rel-id",c=r.getAttribute("xsi:type")||r.getAttribute("type")||"Relationship",s=r.querySelector("name"),u=r.querySelector("documentation"),y=((p=r.getAttribute("source"))==null?void 0:p.trim())||null,m=((d=r.getAttribute("target"))==null?void 0:d.trim())||null,l={};return r.querySelectorAll("property").forEach(g=>{const f=g.getAttribute("propertyDefinitionRef"),h=o[f]||"unknown",A=g.querySelector("value");l[h.toLowerCase()]=A?A.textContent:""}),{id:i,type:c,name:s?s.textContent:"",documentation:u?u.textContent:"",source:y,target:m,properties:l}});return console.log("âœ… Parsed Links:",t),t}function ye(e){const o=e.querySelector("model");if(!o)return console.warn("No <model> element found in the XML."),{modelName:"Unnamed Model",modelDocumentation:"",nodes:[],links:[]};const n=o.querySelector("name"),a=o.querySelector("documentation"),t=n?n.textContent:"Unnamed Model",r=a?a.textContent:"",i=pe(e),c=me(e,i),s=ge(e,i);return console.log("ðŸŽ¯ Final Graph Data JSON:",{modelName:t,modelDocumentation:r,nodesCount:c.length,linksCount:s.length}),{modelName:t,modelDocumentation:r,nodes:c,links:s}}let B={layers:[],elementTypes:[],relationshipTypes:[]};const K=[];function C(){return JSON.parse(JSON.stringify(B))}function fe(e){B={...B,...e},console.log("Facet state updated:",B),K.forEach(o=>o(C()))}function he(e){K.push(e)}const k="archiGraphDataStore";let W=null,x=null;const N=(async()=>(await D.init(),W=new D.Database,x=new D.Connection(W),console.log("KÃ¹zu in-memory DB created successfully."),await x.query(`
    CREATE NODE TABLE IF NOT EXISTS Element(
      id    STRING PRIMARY KEY,
      layer STRING,
      type  STRING,
      name  STRING
    );
  `),await x.query(`
    CREATE REL TABLE IF NOT EXISTS Relationship(
      FROM Element TO Element,
      type STRING
    );
  `),console.log("KÃ¹zu 'Element' & 'Relationship' tables ready."),x))();function M(e){return e!=null&&e.length?`[${e.map(o=>`'${o}'`).join(",")}]`:"[]"}async function R(e){try{const o=await N;if(!o)throw new Error("KÃ¹zu DB not ready.");const{layers:n,elementTypes:a,relationshipTypes:t}=C(),r=n.length?`a.layer IN ${M(n)} AND b.layer IN ${M(n)}`:"true",i=a.length?`a.type IN ${M(a)} AND b.type IN ${M(a)}`:"true",c=t.length?`r.type IN ${M(t)}`:"true",u=`
      MATCH (a:Element)-[r:Relationship]->(b:Element)
      WHERE ${`${r} AND ${i} AND ${c}`}
      RETURN a, r, b
      LIMIT 1000
    `;console.log("Global Filter Query:",u);const y=await o.query(u),m=await ve(y);sessionStorage.setItem(k,JSON.stringify(m,(l,p)=>typeof p=="bigint"?p.toString():p)),typeof e=="function"&&e(m)}catch(o){console.error("Error in global filtering:",o),alert("Error in global filtering: "+o.message)}}function Ae(e){if(e.querySelector('folder[type="elements"]')||e.querySelector('folder[type="relations"]'))return console.log("Detected Archi .archimate file â†’ Archi parser."),ue(e);const o=e.querySelector("model > elements"),n=e.querySelector("model > relationships");if(o&&n)return console.log("Detected ArchiMate Exchange Format â†’ Exchange parser."),ye(e);throw new Error("Could not detect Archi/Exchange file format from XML.")}async function Y(e,o){var n,a,t;try{const r=await N;if(!r)throw new Error("KÃ¹zu connection not established.");const i=new DOMParser().parseFromString(e,"text/xml"),c=Ae(i);if(!((n=c.nodes)!=null&&n.length))throw new Error("Parsed data is empty or missing relationships.");sessionStorage.setItem(k,JSON.stringify(c)),await r.query("MATCH (n:Element) DELETE n;"),await r.query("MATCH ()-[r:Relationship]->() DELETE r;");for(const s of c.nodes){const u=(s.id||"").replace(/'/g,"\\'"),y=(s.type||"").replace(/'/g,"\\'"),m=(s.name||"").replace(/'/g,"\\'");let l=((a=s.layer)==null?void 0:a.trim())||"";if(!l&&s.type){const p=s.type.toLowerCase(),d=["capability","courseofaction","resource","valuestream"],g=["assessment","constraint","driver","goal","meaning","outcome","principle","requirement","stakeholder","value"],f=["deliverable","gap","implementationevent","plateau","workpackage"],h=["applicationcomponent","applicationcollaboration","applicationevent","applicationfunction","applicationinteraction","applicationinterface","applicationprocess","applicationservice","dataobject"],A=["technology","artifact","communicationnetwork","device","node","path","systemsoftware","technologycollaboration","technologyevent","technologyfunction","technologyinteraction","technologyinterface","technologyprocess","technologyservice"],E=["grouping","location"];d.some(S=>p.includes(S))?l="Strategy":g.some(S=>p.includes(S))?l="Motivation":f.some(S=>p.includes(S))?l="Implementation & Migration":p.includes("business")?l="Business":h.some(S=>p.includes(S))?l="Application":A.some(S=>p.includes(S))?l="Technology":E.some(S=>p.includes(S))&&(l="Other/Supporting")}l||(l="Business"),await r.query(`
        CREATE (:Element {
          id:    '${u}',
          layer: '${l}',
          type:  '${y}',
          name:  '${m}'
        });
      `)}for(const s of c.links){const u=(s.source||"").replace(/'/g,"\\'"),y=(s.target||"").replace(/'/g,"\\'");if(!u||!y)continue;const m=(((t=s.type)==null?void 0:t.trim())||"Unknown").replace(/'/g,"\\'");await r.query(`
        MATCH (a:Element {id: '${u}'}), (b:Element {id: '${y}'})
        CREATE (a)-[:Relationship {type: '${m}'}]->(b);
      `)}console.log("Data inserted into KÃ¹zu successfully."),typeof o=="function"&&o()}catch(r){throw console.error("Error processing model file & inserting into KÃ¹zu:",r),r}}async function q(e,o){try{await N;const n=await fetch(e);if(!n.ok)throw new Error(n.statusText);await Y(await n.text(),o)}catch(n){console.error("Error retrieving model file:",n)}}function Se(){return!!sessionStorage.getItem(k)}function _(){const e=sessionStorage.getItem(k);return e?JSON.parse(e):{nodes:[],links:[]}}function Ee(){sessionStorage.removeItem(k)}function Le(){const e=_();return{modelName:e.modelName||"No Model Name",modelDocumentation:e.modelDocumentation||""}}async function Me(e,o=1,n=C(),a){try{const t=await N;if(!t)throw new Error("KÃ¹zu DB not ready.");const i=`
      MATCH p = (:Element {id: '${(e||"").replace(/'/g,"\\'")}'})-[:Relationship*1..${o}]-(:Element)
      RETURN collect(p) AS paths;
    `;console.log("Select Node Neighborhood:",i);const c=await t.query(i);if(!(c!=null&&c.getAllObjects)){console.error("Neighborhood query returned invalid result:",c);const h={nodes:[],links:[]};return typeof a=="function"&&a(h),h}const s=await c.getAllObjects(),u=s.length?s[0].paths||[]:[],y=we(u),{layers:m=[],relationshipTypes:l=[],elementTypes:p=[]}=n,d=y.links.filter(h=>!l.length||l.includes(h.type)),f={nodes:y.nodes.filter(h=>{const A=!m.length||m.includes(h.layer),E=!p.length||p.includes(h.type);return d.some(U=>U.source===h.id||U.target===h.id)&&A&&E}),links:d};return typeof a=="function"&&a(f),f}catch(t){return console.error("Error in neighborhood query:",t),alert("Error in neighborhood query: "+t.message),{nodes:[],links:[]}}}function we(e=[]){const o=new Map,n=[];return e.forEach(a=>{const t=a._nodes??a._NODES??[],r=a._rels??a._RELS??[];t.forEach(i=>{(i==null?void 0:i.id)!=null&&o.set(i.id,i)});for(let i=0;i<r.length;i++){const c=t[i],s=t[i+1],u=r[i];c&&s&&u&&n.push({source:c.id,target:s.id,type:u.type||"Relationship"})}}),{nodes:Array.from(o.values()),links:n}}async function ve(e){if(!(e!=null&&e.getAllObjects))return console.error("buildSubgraphFromRecords: invalid queryResult"),{nodes:[],links:[]};let o=await e.getAllObjects();Array.isArray(o)||(o=[]);const n=new Map,a=[];return o.forEach(t=>{const r=t.a||t.A,i=t.b||t.B,c=t.r||t.R;r!=null&&r.id&&n.set(r.id,r),i!=null&&i.id&&n.set(i.id,i),c!=null&&c.type&&(r!=null&&r.id)&&(i!=null&&i.id)&&a.push({source:r.id,target:i.id,type:c.type})}),{nodes:Array.from(n.values()),links:a}}const $="/data/ArchiSurance.archimate",be=!0,ee=e=>{switch(e){case"ApplicationComponent":case"ApplicationCollaboration":case"ApplicationEvent":case"ApplicationFunction":case"ApplicationInteraction":case"ApplicationInterface":case"ApplicationProcess":case"ApplicationService":case"DataObject":return"#b6f4f6";case"BusinessActor":case"BusinessCollaboration":case"BusinessEvent":case"BusinessFunction":case"BusinessInteraction":case"BusinessInterface":case"BusinessObject":case"BusinessProcess":case"BusinessRole":case"BusinessService":case"Contract":case"Product":case"Representation":case"Location":return"#ffffb1";case"Assessment":case"Constraint":case"Driver":case"Goal":case"Meaning":case"Outcome":case"Principle":case"Requirement":case"Stakeholder":case"Value":return"#ccf";case"DistributionNetwork":case"Equipment":case"Facility":case"Material":return"#d1f6c5";case"Artifact":case"CommunicationNetwork":case"Device":case"Node":case"Path":case"SystemSoftware":case"TechnologyCollaboration":case"TechnologyEvent":case"TechnologyFunction":case"TechnologyInteraction":case"TechnologyInterface":case"TechnologyProcess":case"TechnologyService":return"#d1f6c5";case"Capability":case"CourseOfAction":case"Resource":case"ValueStream":return"#f5deaa";case"Deliverable":case"Gap":case"ImplementationEvent":case"Plateau":case"WorkPackage":return"#ffe0e0"}return"#fefefe"},ke=e=>{switch(e){case"ApplicationComponent":return"m -5 1 l 4 0 l 0 2 l -4 0 z m 0 -4 l 4 0 l 0 2 l -4 0 z m 2 0 l 0 -2 l 8 0 l 0 10 l -8 0 l 0 -2 m 0 -2 l 0 -2";case"Artifact":return"M 4 -1 V 5 H -4 V -5 H 0 L 3.35 -1.5 H 0 V -5";case"Assessment":return"m -3.5 -2 C -3.5 -8 5.5 -8 5.5 -2 C 5.5 4 -3.5 4 -3.5 -2 M -1 2 L -4 7";case"ApplicationCollaboration":case"BusinessCollaboration":case"TechnologyCollaboration":return"m -7 0 A 1 1 0 0 0 2 0 A 1 1 0 0 0 -7 0 M -2 0 A 1 1 0 0 0 7 0 A 1 1 0 0 0 -2 0";case"ApplicationEvent":case"BusinessEvent":case"TechnologyEvent":case"ImplementationEvent":return"m -5 -4 C -2 -3 -2 3 -5 4 H 3 C 6 3 6 -3 3 -4 H -5 M 3 -4";case"ApplicationFunction":case"BusinessFunction":case"TechnologyFunction":return"M -0.35 -5.2 L 4 -1 L 4 5 L 0 2 L -4 5 L -4 -1 L 0.35 -5.2";case"ApplicationInteraction":case"BusinessInteraction":case"TechnologyInteraction":return"m -1 -5 C -6 -4 -6 4 -1 5 Z M 1 -5 V -5 C 6 -4 6 4 1 5 Z";case"ApplicationInterface":case"BusinessInterface":case"TechnologyInterface":return"m -3 0 z c 0 -6 9 -6 9 0 C 6 6 -3 6 -3 0 H -8 z";case"ApplicationProcess":case"BusinessProcess":case"TechnologyProcess":return"m -5 -1.5 H 2 V -4 L 6 0 L 2 4 V 1.5 H -5 z";case"ApplicationService":case"BusinessService":case"TechnologyService":return"m -4 3 z c -4 0 -4 -6 0 -6 H 4 C 8 -3 8 3 4 3 z";case"BusinessActor":return"m 0 -2 A 1 1 0 0 0 0 -6 A 1 1 0 0 0 0 -2 V 3 M -3 6 L 0 3 M 3 6 L 0 3 M -3 0 H 3";case"BusinessRole":case"Stakeholder":return"m -4 -3 C -6 -3 -6 3 -4 3 H 4 C 6 3 6 -3 4 -3 H -4 M 4 -3 c -2 0 -2 6 0 6";case"BusinessObject":case"DataObject":return"m -5 -5 H 5 V 5 V 5 V 5 H -5 Z M -5 -3 H 5";case"Capability":return"m -4.5 4.5 h 9 v -9 h -3 v 9 m 3 -6 h -6 v 6 m 6 -3 h -9 v 3";case"CommunicationNetwork":return"m -4 -3 A 1 1 0 0 0 -1 -3 m 0 0 A 1 1 0 0 0 -4 -3 m 6 0 A 1 1 0 0 0 5 -3 A 1 1 0 0 0 2 -3 H -1 m -4 6 A 1 1 0 0 0 -2 3 A 1 1 0 0 0 -5 3 m 6 0 A 1 1 0 0 0 4 3 A 1 1 0 0 0 1 3 H -2 M -2.5 -1.5 L -3.5 1.5 M 3.5 -1.5 L 2.5 1.5";case"Constraint":return"m -4 -4 H 6 L 4 4 H -6 L -4 -4 M -3 4 L -1 -4";case"Contract":return"m -5 -5 H 5 V 5 V 5 V 5 H -5 Z M -5 -3 H 5 M -5 3 H 5";case"CourseOfAction":return"M -4 -1 A 1 1 0 0 0 6 -1 M 6 -1 A 1 1 0 0 0 -4 -1 M -2 -1 A 1 1 0 0 0 4 -1 A 1 1 0 0 0 -2 -1 M 0 -1 A 1 1 0 0 0 2 -1 A 1 1 0 0 0 0 -1 m 0.5 0 a 0.5 0.5 0 0 0 1 0 a 0.5 0.5 0 0 0 -1 0 m 0.5 0 m -6 3 L -2.5 2.5 L -3 5 Z M -6 5 Q -6 3 -4 3 L -3.5 4 Q -5 4 -5 6 Z";case"Deliverable":return"M -5 2 V -3.5 H 5 V 2 Q 2.5 0 0 2 Q -2.5 4 -5 2 Z";case"Device":return"M -3 2 L -5 5 H 5 L 3 2 H 4 C 5 2 5 2 5 1 V -4 C 5 -5 5 -5 4 -5 h -8 C -5 -5 -5 -5 -5 -4 V 1 C -5 2 -5 2 -4 2 H -3 H 3";case"Driver":return"M -5 0 A 1 1 0 0 0 5 0 M 5 0 A 1 1 0 0 0 -5 0 M -3 0 A 1 1 0 0 0 3 0 A 1 1 0 0 0 -3 0 M -1 0 A 1 1 0 0 0 1 0 A 1 1 0 0 0 -1 0 M -0.5 0 A 0.5 -0.5 0 0 0 0.5 0 A 0.5 0.5 0 0 0 -0.5 0";case"Gap":return"M -5 0 A 1 1 0 0 0 5 0 M 5 0 A 1 1 0 0 0 -5 0 M -6.3 1.5 H 6.3 M -6.3 -1.5 H 6.3";case"Goal":return"M -5 0 A 1 1 0 0 0 5 0 M 5 0 A 1 1 0 0 0 -5 0 M -3 0 A 1 1 0 0 0 3 0 A 1 1 0 0 0 -3 0 M -1 0 A 1 1 0 0 0 1 0 A 1 1 0 0 0 -1 0";case"Location":return"m 4 -1 C 6 -8 -6 -8 -4 -1 L 0 6 Z";case"Meaning":return"M -5 0 C -7 -1 -3 -5 -2 -3 C 0 -5 3 -4 2 -2 C 4 -3 6 -2 5 0 C 7 1 5 4 2 3 C 3 5 -3 5 -3 3 C -5 4 -6 2 -5 0 Z";case"Node":return"m -5 -3 V 5 h 8 v -8.5 h -7.32 l 2 -2 H 5 V 2 L 3.1 5.23 M 3 -3 L 5 -5";case"Outcome":return"M -5 0 A 1 1 0 0 0 5 0 M 5 0 A 1 1 0 0 0 -5 0 M -3 0 A 1 1 0 0 0 3 0 A 1 1 0 0 0 -3 0 M -1 0 A 1 1 0 0 0 1 0 A 1 1 0 0 0 -1 0 M -0.5 0 A 0.5 -0.5 0 0 0 0.5 0 A 0.5 0.5 0 0 0 -0.5 0 M 0 0 L 5.7 -5.7 M 4.5 -7 L 4.2 -4.2 L 7 -4.5";case"Path":return"m -3 4 L -6 0 L -3 -4 M 3 -4 L 6 0 L 3 4 M -3.2 -0.2 H -2.8 V 0.2 H -3.2 Z M -0.2 -0.2 H 0.2 V 0.2 H -0.2 Z M 2.8 -0.2 H 3.2 V 0.2 H 2.8 Z";case"Plateau":return"M -5 0 H 5 M -6 2.4 H 4 M -4 -2.4 H 6";case"Principle":return"M -5 -5 Q -5 -6 -4 -6 Q 0 -6 4 -6 Q 5 -6 5 -5 V 5 Q 5 6 4 6 H -4 Q -5 6 -5 5 Z M -0.35 1.5 V -4 H 0.35 V 1.5 Z M -0.35 3.35 V 4 H 0.35 V 3.35 Z";case"Product":return"m -5 -5 H 5 V 5 V 5 V 5 H -5 Z M -5 -3 H 0 V -5";case"Representation":return"m -5 -5 H 5 v 9 v 0 v 0 c -5 -3 -5 3 -10 0 Z M -5 -3 H 5";case"Requirement":return"m -4 -4 H 6 L 4 4 H -6 Z";case"Resource":return"M -6 -3 Q -6 -4 -5 -4 H 4 Q 5 -4 5 -3 V 3 Q 5 4 4 4 H -5 Q -6 4 -6 3 z m 11 5 A 1 1 0 0 0 6 1 V -1 A 1 1 0 0 0 5 -2 Z M -4 -2 H -4 V 2 M -2 -2 V 2 M 0 -2 V 2";case"SystemSoftware":return"m -6 1 Z c 0 -7 10 -7 10 0 c 0 7 -10 7 -10 0 z m 1 -3.3 c 4 -8.7 15 -1.7 8 6.6";case"Value":return"m -6 0 C -6 -6 6 -6 6 0 C 6 6 -6 6 -6 0";case"ValueStream":return"M 6 0 L 3 4 H -5 L -2 0 L -5 -4 H 3 Z";case"WorkPackage":return"M 3 2 V 0.5 L 5.2 2 L 3 3.5 V 2 H 3.4 V 1.4 L 4.2 2 L 3.4 2.6 V 2 M 3 2 H -2 A 3.4 3.4 0 1 1 0.4 1";case"AndJunction":case"OrJunction":return"M -5 0 A 1 1 0 0 0 5 0 M 5 0 A 1 1 0 0 0 -5 0"}return""},Ie=(e,o,n,a,t)=>{const i=n.append("g").attr("id","nodes").selectAll("g").data(a).enter().append("g").attr("id",s=>s.id).attr("class",s=>"element-"+s.type.toLowerCase()).classed("node-root",s=>t!==null&&s.id===t?(s.fx=e/2,s.fy=o*.9/2,!0):!1);return i.append("circle").attr("r",10).attr("fill",s=>ee(s.type)).append("title").text(s=>{let u=s.name;return s.documentation!==void 0&&s.documentation.length>0&&(u+=" - "+s.documentation),u}),i.append("path").attr("d",s=>ke(s.type)).attr("class","node-icon"),i.append("text").attr("class","node-label-type").attr("dx",s=>16).attr("dy",s=>-2).text(s=>"("+s.type+")"),i.append("text").attr("class","node-label-name").attr("dx",s=>16).attr("dy",s=>8).text(s=>s.name),i},xe={colorForNodeType:ee},Q=e=>{const o=e.append("defs"),n=10,a=10;o.append("marker").attr("id","relationship-arrow-open").attr("viewBox",[0,-8,20,20]).attr("refX",31).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",n).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("class","relationship-arrow-open"),o.append("marker").attr("id","relationship-arrow-open-read").attr("viewBox",[0,-8,20,20]).attr("refX",-21).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",n).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M10,-5L0,0L10,5").attr("class","relationship-arrow-open"),o.append("marker").attr("id","relationship-arrow-closed").attr("viewBox",[0,-8,20,20]).attr("refX",31).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",n).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("class","relationship-arrow-closed"),o.append("marker").attr("id","relationship-arrowlarge-open").attr("viewBox",[0,-8,20,20]).attr("refX",31).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",n).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M 0 0 L 0 -8 L 10 0 L 0 8 L 0 0").attr("class","relationship-arrowlarge-open"),o.append("marker").attr("id","relationship-diamond-open-start").attr("viewBox",[0,-8,22,22]).attr("refX",-23).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",n).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M 0 0 L 8 -6 L 16 0 L 8 6 L 0 0").attr("class","relationship-diamond-open"),o.append("marker").attr("id","relationship-diamond-closed-start").attr("viewBox",[0,-8,22,22]).attr("refX",-23).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",n).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M 0 0 L 8 -6 L 16 0 L 8 6 L 0 0").attr("class","relationship-diamond-closed"),o.append("marker").attr("id","relationship-circle-closed-start").attr("viewBox",[0,-8,22,22]).attr("refX",-23).attr("refY",0).attr("markerUnits","userSpaceOnUse").attr("markerWidth",n).attr("markerHeight",a).attr("orient","auto").append("path").attr("d","M 5, 0 m -5, 0 a 5,5 0 1,0 10,0 a 5,5 0 1,0 -10,0").attr("class","relationship-circle-closed")},Be=(e,o)=>{const n=e.append("g").attr("id","links").selectAll("line").data(o).enter().append("line").attr("id",a=>a.id).attr("class",a=>"relationship-"+a.type.toLowerCase()).attr("marker-start",a=>Te(a)).attr("marker-end",a=>Ce(a)).attr("stroke","#666").attr("stroke-width",1);return n.append("title").text(a=>a.name),n},Te=e=>{switch(e.type){case"Access":return e.accessType==="Read"||e.accessType==="ReadWrite"?"url(#relationship-arrow-open-read)":null;case"Aggregation":return"url(#relationship-diamond-open-start)";case"Composition":return"url(#relationship-diamond-closed-start)";case"Assignment":return"url(#relationship-circle-closed-start)"}},Ce=e=>{switch(e.type){case"Triggering":case"Assignment":case"Flow":return"url(#relationship-arrow-closed)";case"Influence":case"Serving":return"url(#relationship-arrow-open)";case"Access":return e.accessType==="Write"||e.accessType==="ReadWrite"?"url(#relationship-arrow-open)":null;case"Realization":case"Specialization":return"url(#relationship-arrowlarge-open)"}};function w(e){return typeof e=="object"&&e.id?e.id:e}function Ne(e,o,n,a){if(!e.length)return;const t=new Set(e.map(l=>l.id)),r=o.filter(l=>{const p=typeof l.source=="object"?l.source.id:l.source,d=typeof l.target=="object"?l.target.id:l.target;return t.has(p)&&t.has(d)}),i=Array.from(new Set(e.map(l=>l.layer).filter(Boolean)));if(i.length<=1){const l=G(e).force("link",X(r).id(p=>p.id).distance(80).strength(.2)).force("charge",j().strength(-100)).force("collide",Z(25)).force("center",J(n/2,a/2));l.stop();for(let p=0;p<300;++p)l.tick();return}const c=n*.5,s=a*.5,u=Math.min(n,a)*.35,y=new Map;i.forEach((l,p)=>{const d=2*Math.PI*p/i.length;y.set(l,{x:c+Math.cos(d)*u,y:s+Math.sin(d)*u})});const m=G(e).force("link",X(r).id(l=>l.id).distance(70).strength(.08)).force("charge",j().strength(-300)).force("collide",Z(30)).force("center",J(c,s)).force("clusterX",ae(l=>{const p=y.get(l.layer);return p?p.x:c}).strength(.8)).force("clusterY",se(l=>{const p=y.get(l.layer);return p?p.y:s}).strength(.8));m.stop();for(let l=0;l<300;++l)m.tick()}function P(e,o,n,a,t){re("#graph-viewer").remove();const r=a.clientWidth,i=a.clientHeight,c=I(a).append("svg").attr("id","graph-viewer").attr("width",r).attr("height",i);Ne(e,n,r,i),Q&&Q(c);const s=c.append("g").attr("id","viewer"),u=n.filter(d=>e.some(g=>g.id===w(d.source))&&e.some(g=>g.id===w(d.target))),y=Be(s,u).attr("stroke-opacity",.6),m=(d,g)=>{const f=w(d),h=e.find(A=>A.id===f);return h?h[g]:0};y.attr("x1",d=>m(d.source,"x")).attr("y1",d=>m(d.source,"y")).attr("x2",d=>m(d.target,"x")).attr("y2",d=>m(d.target,"y"));const l=Ie(r,i,s,e,o).attr("transform",d=>`translate(${d.x},${d.y})`);l.classed("pinned-node",d=>d.id===o).select("text").classed("pinned-node",d=>d.id===o),l.on("dblclick",function(d,g){d.stopPropagation();const f=+document.getElementById("depthInput").value||1,h=C();document.getElementById("loading-message").style.display="block",Me(g.id,f,h,A=>{document.getElementById("loading-message").style.display="none",P(A.nodes,g.id,A.links,a)})});const p=oe().on("start",function(d,g){I(this).classed("dragging-node",!0)}).on("drag",function(d,g){g.x=d.x,g.y=d.y,I(this).attr("transform",`translate(${g.x},${g.y})`),y.filter(f=>w(f.source)===g.id||w(f.target)===g.id).attr("x1",f=>m(f.source,"x")).attr("y1",f=>m(f.source,"y")).attr("x2",f=>m(f.target,"x")).attr("y2",f=>m(f.target,"y"))}).on("end",function(d,g){I(this).classed("dragging-node",!1)});if(l.call(p),c.call(ne().on("zoom",d=>s.attr("transform",d.transform))).on("dblclick.zoom",null),c.insert("rect",":first-child").attr("width",r).attr("height",i).attr("fill","transparent").on("click",()=>{l.classed("pinned-node",!1).select("text").classed("pinned-node",!1)}),!e.length)c.attr("viewBox",`0 0 ${r} ${i}`);else{let d=1e9,g=1e9,f=-1e9,h=-1e9;e.forEach(E=>{d=Math.min(d,E.x),g=Math.min(g,E.y),f=Math.max(f,E.x),h=Math.max(h,E.y)});const A=20;c.attr("viewBox",`${d-A} ${g-A} ${f-d+2*A} ${h-g+2*A}`)}}const F="archiGraphUserSettings";let O={userLoadedModel:!1,userLoadedModelFilename:"",stickyNodesOnDrag_Enabled:!0};const De=e=>{localStorage.setItem(F,JSON.stringify(e))},T=()=>{let e=O;return localStorage.getItem(F)&&(e=JSON.parse(localStorage.getItem(F))),e},V=e=>{let o=T();return!(e in o)&&e in O&&(L(e,O[e]),o=T()),o[e]},L=(e,o)=>{let n=T();n[e]=o,De(n)},He=()=>{const e=T();if(e.userLoadedModel){const o=document.getElementById("userModelLoad-dragDrop-message");o.innerText=`Current loaded model: ${e.userLoadedModelFilename}`,document.getElementById("userModelLoad-delete").classList.remove("hidden")}document.getElementById("stickyNodesOnDrag").checked=V("stickyNodesOnDrag_Enabled"),document.getElementById("dialog-userSettings").showModal()},Fe=()=>{document.getElementById("dialog-userSettings").close(),document.getElementById("userModelLoad-dragDrop-message").innerText=""},Oe=(e,o)=>{var i;const n=((i=e.dataTransfer)==null?void 0:i.files)||e.target.files;if(!n||n.length===0){alert("No files were detected. Please try again.");return}const a=n[0];if(![".xml",".archimate"].some(c=>a.name.endsWith(c))){alert("Oops, it must be an .xml or .archimate file! Please ensure it is an ArchiMate Exchange Format or Archi file.");return}const t=document.getElementById("userModelLoad-dragDrop-message");t.innerText=`Loading: ${a.name}`;const r=new FileReader;r.onload=()=>{Y(r.result,()=>{L("userLoadedModel",!0),L("userLoadedModelFilename",a.name),document.getElementById("userModelLoad-delete").classList.remove("hidden"),t.innerText=`The ${a.name} file has been loaded.`,typeof o=="function"&&o()})},r.readAsText(a)},Re=()=>{const e=V("userLoadedModelFilename");Ee();const o=document.getElementById("userModelLoad-dragDrop-message");o.innerText=`${e} has been deleted, the default model has been loaded`,L("userLoadedModel",!1),L("userLoadedModelFilename",""),document.getElementById("userModelLoad-delete").classList.add("hidden")};function qe(){const o=[{id:"group-strategy",layer:"Strategy"},{id:"group-business",layer:"Business"},{id:"group-application",layer:"Application"},{id:"group-technology",layer:"Technology"},{id:"group-physical",layer:"Physical"},{id:"group-impl",layer:"Implementation & Migration"},{id:"group-motivation",layer:"Motivation"},{id:"group-other",layer:"Other/Supporting"},{id:"group-composite",layer:"Other/Supporting"}].filter(t=>{var r;return(r=document.getElementById(t.id))==null?void 0:r.checked}).map(t=>t.layer);o.length||o.push("Strategy","Business","Application","Technology","Physical","Implementation & Migration","Motivation","Other/Supporting");const n=Array.from(document.querySelectorAll(".facet-value:not([data-group='relationships']):checked")).map(t=>t.value),a=Array.from(document.querySelectorAll(".facet-value[data-group='relationships']:checked")).map(t=>t.value);return{layers:o,elementTypes:n,relationshipTypes:a}}function H(e=!1){const o=qe();fe(o),e&&R(()=>{document.dispatchEvent(new Event("kuzuFiltersDone"))})}function $e(){var e;(e=document.getElementById("applyFiltersBtn"))==null||e.addEventListener("click",()=>H(!0)),document.addEventListener("change",o=>{(o.target.matches(".facet-value")||o.target.id.startsWith("group-"))&&H(!1)}),H(!1)}const{colorForNodeType:Pe}=xe;function v(e){return e.replace(/[<>&'"]/g,function(o){switch(o){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})}function Ve(e,o){const n={Capability:1,CourseOfAction:1,Resource:1,ValueStream:1,BusinessActor:2,BusinessCollaboration:2,BusinessEvent:2,BusinessFunction:2,BusinessInteraction:2,BusinessInterface:2,BusinessObject:2,BusinessProcess:2,BusinessRole:2,BusinessService:2,Contract:2,Product:2,Representation:2,ApplicationComponent:3,ApplicationCollaboration:3,ApplicationEvent:3,ApplicationFunction:3,ApplicationInteraction:3,ApplicationInterface:3,ApplicationProcess:3,ApplicationService:3,DataObject:3,Artifact:4,CommunicationNetwork:4,Device:4,Node:4,Path:4,SystemSoftware:4,TechnologyCollaboration:4,TechnologyEvent:4,TechnologyFunction:4,TechnologyInteraction:4,TechnologyInterface:4,TechnologyProcess:4,TechnologyService:4,"Distribution Network":5,Equipment:5,Facility:5,Material:5},a={};e.forEach(r=>{a[r.id]=r.type});let t=`<?xml version="1.0" encoding="utf-8"?>
`;return t+=`<graphml xmlns="http://graphml.graphdrawing.org/xmlns"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:y="http://www.yworks.com/xml/graphml"
    xsi:schemaLocation="http://graphml.graphdrawing.org/xmlns
      http://www.yworks.com/xml/schema/graphml/1.0/ygraphml.xsd">
`,t+=`  <key for="node" id="d0" yfiles.type="nodegraphics"/>
`,t+=`  <key attr.name="description" attr.type="string" for="node" id="d1"/>
`,t+=`  <key for="edge" id="d2" yfiles.type="edgegraphics"/>
`,t+=`  <key attr.name="description" attr.type="string" for="edge" id="d3"/>
`,t+=`  <graph id="G" edgedefault="directed">
`,e.forEach(r=>{const i=v(r.id),c=(r.name||"")+(r.type?` (${r.type})`:""),s=Pe(r.type),u=r.x!==void 0?parseFloat(r.x):0,y=r.y!==void 0?parseFloat(r.y):0,m=100,l=40;t+=`    <node id="${i}">
`,t+=`      <data key="d0">
`,t+=`        <y:ShapeNode>
`,t+=`          <y:Geometry x="${u}" y="${y}" width="${m}" height="${l}"/>
`,t+=`          <y:Fill color="${s}" transparent="false"/>
`,t+=`          <y:BorderStyle color="#000000" type="line" width="1.0"/>
`,t+=`          <y:NodeLabel alignment="center" autoSizePolicy="node_width" fontFamily="Dialog" fontSize="5" fontStyle="plain" textColor="#000000" visible="true" modelName="internal" modelPosition="c">
`,t+=`            ${v(c)}
`,t+=`          </y:NodeLabel>
`,t+=`          <y:Shape type="rectangle"/>
`,t+=`        </y:ShapeNode>
`,t+=`      </data>
`,t+=`    </node>
`}),o.forEach((r,i)=>{let c=typeof r.source=="object"?r.source.id:r.source,s=typeof r.target=="object"?r.target.id:r.target;const u=a[c],y=a[s];n[u]&&n[y]?n[u]>n[y]&&([c,s]=[s,c]):(r.type==="Realization"||r.type==="Serving")&&([c,s]=[s,c]);const m=`e${i}`;t+=`    <edge id="${v(m)}" source="${v(c)}" target="${v(s)}">
`,t+=`      <data key="d2">
`,t+=`        <y:PolyLineEdge>
`,t+=`          <y:LineStyle color="#000000" type="line" width="1.0"/>
`,t+=`          <y:Arrows source="none" target="standard"/>
`,t+=`          <y:BendStyle smoothed="true"/>
`,t+=`        </y:PolyLineEdge>
`,t+=`      </data>
`,t+=`    </edge>
`}),t+=`  </graph>
`,t+=`</graphml>
`,t}function ze(e,o){const n=new Blob([e],{type:"application/xml"}),a=URL.createObjectURL(n),t=document.createElement("a");t.href=a,t.download=o,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)}function Ue(){const e=sessionStorage.getItem("archiGraphDataStore");if(!e){alert("No graph data found in session storage.");return}const o=JSON.parse(e);let n=Array.isArray(o.nodes)?o.nodes:Object.values(o.nodes||{});const a=o.links||[],t={};n.forEach(c=>{t[c.id]=c}),a.forEach(c=>{const s=typeof c.source=="object"?c.source.id:c.source,u=typeof c.target=="object"?c.target.id:c.target;t[s]||(t[s]={id:s,name:s,type:"Undefined",x:0,y:0}),t[u]||(t[u]={id:u,name:u,type:"Undefined",x:0,y:0})}),n=Object.values(t);const r=Ve(n,a),i=(o.modelName||"graph")+".graphml";ze(r,i)}typeof document<"u"&&document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("exportGraphMLButton");e&&e.addEventListener("click",Ue)});let Ge=typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams;function z(){const e=_();document.getElementById("loading-message").style.display="none",P(e.nodes,null,e.links,document.getElementById("graph-container"))}function b(){document.getElementById("loading-message").style.display="block",R(e=>{document.getElementById("loading-message").style.display="none",P(e.nodes,null,e.links,document.getElementById("graph-container"))})}function Xe(){const e=document.querySelector("header");(Ge.get("showheader")==="true"||be)&&(e.style.display="block"),document.getElementById("action-userSettings").classList.remove("hidden"),document.getElementById("userSettings-userModelLoad").classList.remove("hidden")}function je(e,o){let n;return(...a)=>{clearTimeout(n),n=setTimeout(()=>e(...a),o)}}document.getElementById("action-reload").addEventListener("click",()=>q($,b));document.getElementById("action-model-overview").addEventListener("click",()=>{const e=Le();document.getElementById("model-name").innerText=e.modelName,document.getElementById("model-documentation").innerText=e.modelDocumentation,document.getElementById("dialog-overview").showModal()});["dialog-overview-close","dialog-overview-close-x"].forEach(e=>document.getElementById(e).addEventListener("click",()=>document.getElementById("dialog-overview").close()));document.getElementById("action-userSettings").addEventListener("click",()=>He());["dialog-userSettings-close","dialog-userSettings-close-x"].forEach(e=>document.getElementById(e).addEventListener("click",()=>Fe()));const te=document.getElementById("userModelLoad-dragDrop-zone");te.addEventListener("dragover",e=>e.preventDefault());te.addEventListener("drop",e=>{e.preventDefault(),Oe(e,b)});document.getElementById("userModelLoad-delete").addEventListener("click",()=>{Re(),q($,b)});document.getElementById("stickyNodesOnDrag").addEventListener("change",function(){L("stickyNodesOnDrag_Enabled",this.checked)});$e();document.getElementById("applyFiltersBtn").addEventListener("click",async()=>{document.getElementById("loading-message").style.display="block",await R(()=>{document.getElementById("loading-message").style.display="none";const e=new Event("kuzuFiltersDone");document.dispatchEvent(e)})});he(()=>{});window.onload=async()=>{Xe(),Se()||(L("userLoadedModel",!1),L("userLoadedModelFilename","")),V("userLoadedModel")?b():await q($,b)};window.onresize=je(z,100);window.onpopstate=()=>z();document.addEventListener("kuzuFiltersDone",()=>{console.log("Global filter applied â†’ reâ€‘draw from session"),z()});
