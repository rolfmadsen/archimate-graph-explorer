<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ArchiMate Graph Explorer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=1.5, user-scalable=yes">
    <link rel="icon" type="image/x-icon" href="/assets/archimate_graph_explorer-Bv_El6M-.ico" />
  <script type="module" crossorigin src="/assets/index-ByySgt-z.js"></script>
  <link rel="modulepreload" crossorigin href="/assets/kuzu-wasm-BP5yORNQ.js">
  <link rel="modulepreload" crossorigin href="/assets/d3-dispatch-kxCwF96_.js">
  <link rel="modulepreload" crossorigin href="/assets/d3-timer-DdKHrDhs.js">
  <link rel="modulepreload" crossorigin href="/assets/d3-color-9lF95FHy.js">
  <link rel="modulepreload" crossorigin href="/assets/d3-interpolate-B6xYU604.js">
  <link rel="modulepreload" crossorigin href="/assets/d3-selection-Dub50jOu.js">
  <link rel="modulepreload" crossorigin href="/assets/d3-ease-DRPgKoYJ.js">
  <link rel="modulepreload" crossorigin href="/assets/d3-transition-D-WDeqM-.js">
  <link rel="modulepreload" crossorigin href="/assets/d3-drag-Dv6F3X_l.js">
  <link rel="modulepreload" crossorigin href="/assets/d3-zoom-CTHwvTve.js">
  <link rel="modulepreload" crossorigin href="/assets/d3-quadtree-CSANTnla.js">
  <link rel="modulepreload" crossorigin href="/assets/d3-force-CjnB0ny7.js">
  <link rel="stylesheet" crossorigin href="/assets/index-BJXjN2K_.css">

  <body>
    <!-- Header -->
    <header>
      <div id="header-logo">
        <svg width="20" height="20" viewBox="0 0 20 20">
          <g>
            <path d="M 7 11 A 1 1 0 0 0 11 11 A 1 1 0 0 0 7 11 Z M 8 12 L 5 16 M 2 17 A 1 1 0 0 0 6 17 A 1 1 0 0 0 2 17 M 13 16 L 10 12 m 2 5 A 1 1 0 0 0 16 17 A 1 1 0 0 0 12 17 Z m -5 -13 A 1 1 0 0 0 11 4 A 1 1 0 0 0 7 4 Z M 9 6 L 9 9"/>
          </g>
        </svg>
      </div>
      <h1>ArchiMate Graph Explorer</h1>
      <div id="header-right">
        <div id="action-reload" class="header-action">
          <!--<svg width="20" height="20" viewBox="0 0 20 20">
            <g fill="#eee">
              <title>reload the model</title>
              <path d="M15.65 4.35A8 8 0 1 0 17.4 13h-2.22a6 6 0 1 1-1-7.22L11 9h7V2z"/>
            </g>
          </svg>
          -->
        </div>
        <div id="action-model-overview" class="header-action">
          <svg width="20" height="20" viewBox="0 0 20 20">
            <g fill="#eee">
              <title>model overview</title>
              <path d="M 12 2 A 1 1 0 0 0 12 18 A 1 1 0 0 0 12 2 V 4 A 1 1 0 0 1 12 16 A 1 1 0 0 1 12 4 Z M 11 8 V 15 H 12 H 13 V 8 Z M 11 7 H 13 V 5 H 11 Z"/>
            </g>
          </svg>
        </div>
        <div id="action-userSettings" class="header-action hidden">
          <svg width="20" height="20" viewBox="0 0 20 20">
            <g fill="#eee">
              <title>settings</title>
              <path d="M 12 4 A 1 1 0 0 0 12 16 A 1 1 0 0 0 12 4 V 6 A 1 1 0 0 1 12 14 A 1 1 0 0 1 12 6 Z M 11 2 h 2 v 2 h -2 z M 11 18 h 2 v -2 h -2 z M 4 11 v -2 h 2 v 2 z M 20 9 v 2 h -2 v -2 z"/>
            </g>
          </svg>
        </div>
      </div>
    </header>

    <!-- Main container: Facet sidebar and Graph display -->
    <div id="main-container">
      <!-- Facet Filter Sidebar -->
      <div id="facet-sidebar">

        <!-- Facet Groups -->
        <!-- Relationship Types -->
        <div class="facet-group" id="facet-relationships">
          <h4>
            <span class="dropdown-icon">▶</span>
            <input type="checkbox" id="group-relationships" checked>
            Relationship Types
          </h4>
          <div class="facet-values">
            <label><input type="checkbox" class="facet-value" data-group="relationships" value="Access" checked> Access</label>
            <label><input type="checkbox" class="facet-value" data-group="relationships" value="Aggregation" checked> Aggregation</label>
            <label><input type="checkbox" class="facet-value" data-group="relationships" value="Assignment" checked> Assignment</label>
            <label><input type="checkbox" class="facet-value" data-group="relationships" value="Association" checked> Association</label>
            <label><input type="checkbox" class="facet-value" data-group="relationships" value="Composition" checked> Composition</label>
            <label><input type="checkbox" class="facet-value" data-group="relationships" value="Flow" checked> Flow</label>
            <label><input type="checkbox" class="facet-value" data-group="relationships" value="Influence" checked> Influence</label>
            <label><input type="checkbox" class="facet-value" data-group="relationships" value="Realization" checked> Realization</label>
            <label><input type="checkbox" class="facet-value" data-group="relationships" value="Serving" checked> Serving</label>
            <label><input type="checkbox" class="facet-value" data-group="relationships" value="Specialization" checked> Specialization</label>
            <label><input type="checkbox" class="facet-value" data-group="relationships" value="Triggering" checked> Triggering</label>
          </div>
        </div>
        <!-- Strategy Facet Group -->
        <div class="facet-group" id="facet-strategy">
          <h4>
            <span class="dropdown-icon">▶</span>
            <input type="checkbox" id="group-strategy" checked>
            Strategy
          </h4>
          <div class="facet-values">
            <label><input type="checkbox" class="facet-value" data-group="strategy" value="Capability" checked> Capability</label>
            <label><input type="checkbox" class="facet-value" data-group="strategy" value="CourseOfAction" checked> CourseOfAction</label>
            <label><input type="checkbox" class="facet-value" data-group="strategy" value="Resource" checked> Resource</label>
            <label><input type="checkbox" class="facet-value" data-group="strategy" value="ValueStream" checked> ValueStream</label>
          </div>
        </div>
        <!-- Business Facet Group -->
        <div class="facet-group" id="facet-business">
          <h4>
            <span class="dropdown-icon">▶</span>
            <input type="checkbox" id="group-business" checked>
            Business
          </h4>
          <div class="facet-values">
            <label><input type="checkbox" class="facet-value" data-group="business" value="BusinessActor" checked> BusinessActor</label>
            <label><input type="checkbox" class="facet-value" data-group="business" value="BusinessCollaboration" checked> BusinessCollaboration</label>
            <label><input type="checkbox" class="facet-value" data-group="business" value="BusinessEvent" checked> BusinessEvent</label>
            <label><input type="checkbox" class="facet-value" data-group="business" value="BusinessFunction" checked> BusinessFunction</label>
            <label><input type="checkbox" class="facet-value" data-group="business" value="BusinessInteraction" checked> BusinessInteraction</label>
            <label><input type="checkbox" class="facet-value" data-group="business" value="BusinessInterface" checked> BusinessInterface</label>
            <label><input type="checkbox" class="facet-value" data-group="business" value="BusinessObject" checked> BusinessObject</label>
            <label><input type="checkbox" class="facet-value" data-group="business" value="BusinessProcess" checked> BusinessProcess</label>
            <label><input type="checkbox" class="facet-value" data-group="business" value="BusinessRole" checked> BusinessRole</label>
            <label><input type="checkbox" class="facet-value" data-group="business" value="BusinessService" checked> BusinessService</label>
            <label><input type="checkbox" class="facet-value" data-group="business" value="Contract" checked> Contract</label>
            <label><input type="checkbox" class="facet-value" data-group="business" value="Product" checked> Product</label>
            <label><input type="checkbox" class="facet-value" data-group="business" value="Representation" checked> Representation</label>
          </div>
        </div>
        <!-- Application Facet Group -->
        <div class="facet-group" id="facet-application">
          <h4>
            <span class="dropdown-icon">▶</span>
            <input type="checkbox" id="group-application" checked>
            Application
          </h4>
          <div class="facet-values">
            <label><input type="checkbox" class="facet-value" data-group="application" value="ApplicationComponent" checked> ApplicationComponent</label>
            <label><input type="checkbox" class="facet-value" data-group="application" value="ApplicationCollaboration" checked> ApplicationCollaboration</label>
            <label><input type="checkbox" class="facet-value" data-group="application" value="ApplicationEvent" checked> ApplicationEvent</label>
            <label><input type="checkbox" class="facet-value" data-group="application" value="ApplicationFunction" checked> ApplicationFunction</label>
            <label><input type="checkbox" class="facet-value" data-group="application" value="ApplicationInteraction" checked> ApplicationInteraction</label>
            <label><input type="checkbox" class="facet-value" data-group="application" value="ApplicationInterface" checked> ApplicationInterface</label>
            <label><input type="checkbox" class="facet-value" data-group="application" value="ApplicationProcess" checked> ApplicationProcess</label>
            <label><input type="checkbox" class="facet-value" data-group="application" value="ApplicationService" checked> ApplicationService</label>
            <label><input type="checkbox" class="facet-value" data-group="application" value="DataObject" checked> DataObject</label>
          </div>
        </div>
        <!-- TechnologyInterface Facet Group -->
        <div class="facet-group" id="facet-techinterface">
          <h4>
            <span class="dropdown-icon">▶</span>
            <input type="checkbox" id="group-techinterface" checked>
            TechnologyInterface
          </h4>
          <div class="facet-values">
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="Artifact" checked> Artifact</label>
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="CommunicationNetwork" checked> CommunicationNetwork</label>
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="Device" checked> Device</label>
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="Node" checked> Node</label>
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="Path" checked> Path</label>
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="SystemSoftware" checked> SystemSoftware</label>
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="TechnologyCollaboration" checked> TechnologyCollaboration</label>
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="TechnologyEvent" checked> TechnologyEvent</label>
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="TechnologyFunction" checked> TechnologyFunction</label>
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="TechnologyInteraction" checked> TechnologyInteraction</label>
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="TechnologyInterface" checked> TechnologyInterface</label>
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="TechnologyProcess" checked> TechnologyProcess</label>
            <label><input type="checkbox" class="facet-value" data-group="techinterface" value="TechnologyService" checked> TechnologyService</label>
          </div>
        </div>
        <!-- Physical Facet Group -->
        <div class="facet-group" id="facet-physical">
          <h4>
            <span class="dropdown-icon">▶</span>
            <input type="checkbox" id="group-physical" checked>
            Physical
          </h4>
          <div class="facet-values">
            <label><input type="checkbox" class="facet-value" data-group="physical" value="Distribution Network" checked> Distribution Network</label>
            <label><input type="checkbox" class="facet-value" data-group="physical" value="Equipment" checked> Equipment</label>
            <label><input type="checkbox" class="facet-value" data-group="physical" value="Facility" checked> Facility</label>
            <label><input type="checkbox" class="facet-value" data-group="physical" value="Material" checked> Material</label>
          </div>
        </div>
        <!-- Implementation & Migration Facet Group -->
        <div class="facet-group" id="facet-impl">
          <h4>
            <span class="dropdown-icon">▶</span>
            <input type="checkbox" id="group-impl" checked>
            Implementation &amp; Migration
          </h4>
          <div class="facet-values">
            <label><input type="checkbox" class="facet-value" data-group="impl" value="Deliverable" checked> Deliverable</label>
            <label><input type="checkbox" class="facet-value" data-group="impl" value="Gap" checked> Gap</label>
            <label><input type="checkbox" class="facet-value" data-group="impl" value="ImplementationEvent" checked> ImplementationEvent</label>
            <label><input type="checkbox" class="facet-value" data-group="impl" value="Plateau" checked> Plateau</label>
            <label><input type="checkbox" class="facet-value" data-group="impl" value="WorkPackage" checked> WorkPackage</label>
          </div>
        </div>
        <!-- Motivation Facet Group -->
        <div class="facet-group" id="facet-motivation">
          <h4>
            <span class="dropdown-icon">▶</span>
            <input type="checkbox" id="group-motivation" checked>
            Motivation
          </h4>
          <div class="facet-values">
            <label><input type="checkbox" class="facet-value" data-group="motivation" value="Assessment" checked> Assessment</label>
            <label><input type="checkbox" class="facet-value" data-group="motivation" value="Constraint" checked> Constraint</label>
            <label><input type="checkbox" class="facet-value" data-group="motivation" value="Driver" checked> Driver</label>
            <label><input type="checkbox" class="facet-value" data-group="motivation" value="Goal" checked> Goal</label>
            <label><input type="checkbox" class="facet-value" data-group="motivation" value="Meaning" checked> Meaning</label>
            <label><input type="checkbox" class="facet-value" data-group="motivation" value="Outcome" checked> Outcome</label>
            <label><input type="checkbox" class="facet-value" data-group="motivation" value="Principle" checked> Principle</label>
            <label><input type="checkbox" class="facet-value" data-group="motivation" value="Requirement" checked> Requirement</label>
            <label><input type="checkbox" class="facet-value" data-group="motivation" value="Stakeholder" checked> Stakeholder</label>
            <label><input type="checkbox" class="facet-value" data-group="motivation" value="Value" checked> Value</label>
          </div>
        </div>
        <!-- Other Facet Group -->
        <div class="facet-group" id="facet-other">
          <h4>
            <span class="dropdown-icon">▶</span>
            <input type="checkbox" id="group-other" checked>
            Other
          </h4>
          <div class="facet-values">
            <label><input type="checkbox" class="facet-value" data-group="other" value="Grouping" checked> Grouping</label>
            <label><input type="checkbox" class="facet-value" data-group="other" value="AndJunction" checked> AndJunction</label>
            <label><input type="checkbox" class="facet-value" data-group="other" value="OrJunction" checked> OrJunction</label>
            <label><input type="checkbox" class="facet-value" data-group="other" value="Location" checked> Location</label>
          </div>
        </div>
        <!-- Neighborhood Depth Slider -->
        <!--
        <div id="bfsFilter-container" class="filter-container">
          <label>Neighborhood Depth:</label>
          <input type="range" id="depthSlider" min="1" max="10" value="1" />
          <span id="depthSliderValue">1</span>
        </div>
        -->
        <br />
        <!-- Global Filter Button -->
        <button id="applyFiltersBtn">Apply Global Filters</button>
      </div>

      <!-- Main Content: Graph Display -->
      <div id="main-content">
        <div id="graph-container">
          <!-- D3 will render the SVG graph (id="graph-viewer") here -->
        </div>
        <div id="loading-message">Loading...</div>
        <div id="search-result-summary"></div>
      </div>
    </div>
    
    <!-- Dialogs -->
    <dialog id="dialog-overview">
      <div id="dialog-overview-close-x" class="dialog-close-x">X</div>
      <h3>ArchiMate Model</h3>
      <h4 id="model-name"></h4>
      <div id="model-documentation"></div>
      <br /><hr />
      <h3 id="about-title">ArchiMate Graph Explorer</h3>
      <div id="about-documentation">
        The <a href="https://declanbright.com/archimate-graph-explorer">ArchiMate Graph Explorer</a> renders an interactive force‑directed graph from an ArchiMate Model Exchange Format file.
      </div>
      <h4>How to browse</h4>
      <div id="about-documentation">
        <ul>
          <li>Use the facet filter browser on the left to select layers and element types.</li>
          <li>Pan and zoom to move around.</li>
          <li>Drag elements to arrange them.</li>
          <li>Double‑click an element to show its neighborhood (using the slider for depth).</li>
        </ul>
      </div>
      <br /><hr />
      <h3 id="about-title">About</h3>
      <div id="about-documentation">
        <ul style="margin-top: 0.5em;">
          <li>Developed by: <a href="https://declanbright.com">Declan Bright</a></li>
          <li>Source code: <a href="https://github.com/dclnbrght/archimate-graph-explorer">archimate-graph-explorer</a></li>
          <li>License: MIT</li>
        </ul>
      </div>
      <div class="dialog-button-container">
        <button id="dialog-overview-close" class="dialog-button">Close</button>
      </div>
    </dialog>

    <dialog id="dialog-userSettings">
      <div id="dialog-userSettings-close-x" class="dialog-close-x">X</div>
      <h3>User Settings</h3>
      <div id="userSettings-userModelLoad" class="hidden">
        <h4>Load your ArchiMate Model</h4>
        <p>Load your own ArchiMate model by exporting it to an exchange format file. Your model is stored in your browser's session storage.</p>
        <div id="userModelLoad-dragDrop-message"></div>
        <div class="dialog-button-container">
          <button id="userModelLoad-delete" class="userSetting-button hidden">Delete the Loaded Model</button>
        </div>
        <div id="userModelLoad-dragDrop-zone">
          <p>Drag &amp; Drop an ArchiMate Exchange Format file here ...</p>
        </div>
      </div>
      <div id="userSettings-stickyNodesOnDrag">
        <h4>Sticky Elements</h4>
        <input id="stickyNodesOnDrag" type="checkbox" class="dialog-checkbox" checked>
        <p>Elements stick in place when dragged.</p>
      </div>
      <div id="userSettings-exportGraph">
        <h4>Export to yED‑live GraphML format</h4>
        <div class="dialog-button-container">
          <button id="exportGraphMLButton" class="dialog-button">Export</button>
        </div>
      </div>
      <div class="dialog-button-container">
        <button id="dialog-userSettings-close" class="dialog-button">Close</button>
      </div>
    </dialog>

    <!-- Scripts -->
    <script>
      // Facet group toggle behavior and slider update.
      document.addEventListener("DOMContentLoaded", () => {
        const slider = document.getElementById("depthSlider");
        const display = document.getElementById("depthSliderValue");
        //slider.addEventListener("input", () => { display.textContent = slider.value; });
        document.querySelectorAll(".facet-group").forEach(group => {
          const groupHeader = group.querySelector("h4");
          const groupCheckbox = groupHeader.querySelector("input[type='checkbox']");
          const childCheckboxes = group.querySelectorAll(".facet-values input[type='checkbox']");
          const dropdownIcon = groupHeader.querySelector(".dropdown-icon");
          groupCheckbox.addEventListener("change", () => {
            childCheckboxes.forEach(child => child.checked = groupCheckbox.checked);
          });
          childCheckboxes.forEach(child => {
            child.addEventListener("change", () => {
              const allChecked = Array.from(childCheckboxes).every(cb => cb.checked);
              groupCheckbox.checked = allChecked;
            });
          });
          groupHeader.addEventListener("click", (e) => {
            if (e.target.tagName.toLowerCase() !== "input") {
              const valuesDiv = group.querySelector(".facet-values");
              if (valuesDiv.style.display === "none") {
                valuesDiv.style.display = "block";
                dropdownIcon.textContent = "▼";
              } else {
                valuesDiv.style.display = "none";
                dropdownIcon.textContent = "▶";
              }
            }
          });
          // Start collapsed
          group.querySelector(".facet-values").style.display = "none";
          dropdownIcon.textContent = "▶";
        });
      });
    </script>
  </body>
</html>